<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>äº”ç§æ§åˆ¶å™¨è¯¦è§£ | xiaobei</title><meta name="author" content="XiaoBei"><meta name="copyright" content="XiaoBei"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="äº”ç§æ§åˆ¶å™¨è¯¦è§£Kubernetesï¼ˆk8sï¼‰Deploymentã€StatefulSetã€DaemonSetã€Jobã€CronJobäº”ç§æ§åˆ¶å™¨è¯¦è§£ æ–‡ç« ç›®å½•ä¸€ã€Deploymentæ§åˆ¶å™¨æ¦‚è¿°äºŒã€Deploymentå·¥ä½œåŸç†1ï¼‰æ»šåŠ¨å‡çº§2ï¼‰ç‰ˆæœ¬å›æ»šä¸‰ã€Deploymentçš„èµ„æºæ¸…å•æ–‡ä»¶è¯¦è§£å››ã€Deploymentå®æˆ˜1ï¼‰ç¤ºä¾‹12ï¼‰æ‰©ç¼©å®¹3ï¼‰é•œåƒæ›´æ–°4ï¼‰ç‰ˆæœ¬å›é€€äº”ã€Deploymenté‡‘ä¸é›€å‘å¸ƒï¼ˆç°åº¦">
<meta property="og:type" content="article">
<meta property="og:title" content="äº”ç§æ§åˆ¶å™¨è¯¦è§£">
<meta property="og:url" content="http://example.com/2022/07/20/%E4%BA%94%E7%A7%8D%E6%8E%A7%E5%88%B6%E5%99%A8%E8%AF%A6%E8%A7%A3/index.html">
<meta property="og:site_name" content="xiaobei">
<meta property="og:description" content="äº”ç§æ§åˆ¶å™¨è¯¦è§£Kubernetesï¼ˆk8sï¼‰Deploymentã€StatefulSetã€DaemonSetã€Jobã€CronJobäº”ç§æ§åˆ¶å™¨è¯¦è§£ æ–‡ç« ç›®å½•ä¸€ã€Deploymentæ§åˆ¶å™¨æ¦‚è¿°äºŒã€Deploymentå·¥ä½œåŸç†1ï¼‰æ»šåŠ¨å‡çº§2ï¼‰ç‰ˆæœ¬å›æ»šä¸‰ã€Deploymentçš„èµ„æºæ¸…å•æ–‡ä»¶è¯¦è§£å››ã€Deploymentå®æˆ˜1ï¼‰ç¤ºä¾‹12ï¼‰æ‰©ç¼©å®¹3ï¼‰é•œåƒæ›´æ–°4ï¼‰ç‰ˆæœ¬å›é€€äº”ã€Deploymenté‡‘ä¸é›€å‘å¸ƒï¼ˆç°åº¦">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://w.wallhaven.cc/full/kx/wallhaven-kxkdp7.png">
<meta property="article:published_time" content="2022-07-20T15:51:27.000Z">
<meta property="article:modified_time" content="2022-07-21T15:40:53.519Z">
<meta property="article:author" content="XiaoBei">
<meta property="article:tag" content="cloud">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://w.wallhaven.cc/full/kx/wallhaven-kxkdp7.png"><link rel="shortcut icon" href="/img/homepage.jpg"><link rel="canonical" href="http://example.com/2022/07/20/%E4%BA%94%E7%A7%8D%E6%8E%A7%E5%88%B6%E5%99%A8%E8%AF%A6%E8%A7%A3/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: {"limitCount":50,"languages":{"author":"ä½œè€…: XiaoBei","link":"é“¾æ¥: ","source":"æ¥æº: xiaobei","info":"è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'äº”ç§æ§åˆ¶å™¨è¯¦è§£',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-07-21 23:40:53'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/background.css"><link rel="stylesheet" href="/css/test.css"><link rel="stylesheet" href="/css/ahzoo.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/wsnb.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">16</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">6</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">9</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> ä¸»é¡µ</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> åšæ–‡</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> åˆ†ç±»</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> æ ‡ç­¾</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> å½’æ¡£</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://www.linuxcool.com"><i class="fa-fw fa fa-folder-open"></i><span> Linux</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://forsenergy.com/zh-cn/"><i class="fa-fw fa fa-folder-open"></i><span> Windows</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/photos/"><i class="fa-fw fa fa-camera-retro"></i><span> ç›¸å†Œ</span></a></div><div class="menus_item"><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> éŸ³ä¹</span></a></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://www.555kan.net"><i class="fa-fw fas fa-video"></i><span> å½±è§†</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äºç¬”è€…</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="xiaobei"><span class="site-name">xiaobei</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> æœç´¢</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> ä¸»é¡µ</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> åšæ–‡</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> åˆ†ç±»</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> æ ‡ç­¾</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> å½’æ¡£</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://www.linuxcool.com"><i class="fa-fw fa fa-folder-open"></i><span> Linux</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://forsenergy.com/zh-cn/"><i class="fa-fw fa fa-folder-open"></i><span> Windows</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/photos/"><i class="fa-fw fa fa-camera-retro"></i><span> ç›¸å†Œ</span></a></div><div class="menus_item"><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> éŸ³ä¹</span></a></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://www.555kan.net"><i class="fa-fw fas fa-video"></i><span> å½±è§†</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äºç¬”è€…</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">äº”ç§æ§åˆ¶å™¨è¯¦è§£</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2022-07-20T15:51:27.000Z" title="å‘è¡¨äº 2022-07-20 23:51:27">2022-07-20</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2022-07-21T15:40:53.519Z" title="æ›´æ–°äº 2022-07-21 23:40:53">2022-07-21</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/k8s/">k8s</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">å­—æ•°æ€»è®¡:</span><span class="word-count">7.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>29åˆ†é’Ÿ</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="äº”ç§æ§åˆ¶å™¨è¯¦è§£"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»é‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><article class="post-content" id="article-container"><h1 id="äº”ç§æ§åˆ¶å™¨è¯¦è§£"><a href="#äº”ç§æ§åˆ¶å™¨è¯¦è§£" class="headerlink" title="äº”ç§æ§åˆ¶å™¨è¯¦è§£"></a>äº”ç§æ§åˆ¶å™¨è¯¦è§£</h1><p><strong>Kubernetesï¼ˆk8sï¼‰Deploymentã€StatefulSetã€DaemonSetã€Jobã€CronJobäº”ç§æ§åˆ¶å™¨è¯¦è§£</strong></p>
<p><strong>æ–‡ç« ç›®å½•</strong><br>ä¸€ã€Deploymentæ§åˆ¶å™¨æ¦‚è¿°<br>äºŒã€Deploymentå·¥ä½œåŸç†<br>1ï¼‰æ»šåŠ¨å‡çº§<br>2ï¼‰ç‰ˆæœ¬å›æ»š<br>ä¸‰ã€Deploymentçš„èµ„æºæ¸…å•æ–‡ä»¶è¯¦è§£<br>å››ã€Deploymentå®æˆ˜<br>1ï¼‰ç¤ºä¾‹1<br>2ï¼‰æ‰©ç¼©å®¹<br>3ï¼‰é•œåƒæ›´æ–°<br>4ï¼‰ç‰ˆæœ¬å›é€€<br>äº”ã€Deploymenté‡‘ä¸é›€å‘å¸ƒï¼ˆç°åº¦å‘å¸ƒï¼‰<br>å…­ã€æœ‰çŠ¶æ€ã€æ— çŠ¶æ€æœåŠ¡åŒºåˆ«<br>1ï¼‰æ— çŠ¶æ€ï¼š<br>2ï¼‰æœ‰çŠ¶æ€<br>ä¸ƒã€PVã€PVCã€NFSã€SC<br>1ï¼‰PVæ¦‚è¿°<br>2ï¼‰PVCæ¦‚è¿°<br>3ï¼‰é€šè¿‡NFSå®ç°æŒä¹…åŒ–å­˜å‚¨<br>4ï¼‰åŸºäºNFSå­˜å‚¨åˆ›å»ºPV<br>5ï¼‰åŸºäºNFS-PVåˆ›å»ºPVC<br>6ï¼‰SCï¼ˆStorageClassï¼šå­˜å‚¨ç±»ï¼‰<br>7ï¼‰åŸºäºåŠ¨æ€scï¼ˆStorageClassï¼šå­˜å‚¨ç±»ï¼‰åˆ›å»ºä¸€ä¸ªpv<br>å…«ã€StatefulSetæ§åˆ¶å™¨<br>1ï¼‰ç®€ä»‹<br>2ï¼‰å¸¸è§„serviceå’Œæ— å¤´æœåŠ¡åŒºåˆ«<br>3ï¼‰ç‰¹ç‚¹<br>4ï¼‰ç»„æˆéƒ¨åˆ†<br>ä¹ã€DaemonSetæ§åˆ¶å™¨<br>åã€Jobæ§åˆ¶å™¨<br>åä¸€ã€CronJob æ§åˆ¶å™¨<br>åäºŒã€æ€»ç»“<br>1ï¼‰ReplicationControllerï¼ˆRCï¼‰ä¸»è¦åŠŸèƒ½<br>2ï¼‰ReplicaSetä¸»è¦åŠŸèƒ½ï¼ˆRSï¼‰<br>3ï¼‰deploymentçš„ä¸»è¦åŠŸèƒ½<br>4ï¼‰Sate fulSetæ§åˆ¶å™¨<br>5ï¼‰DaemonSetæ§åˆ¶å™¨<br>6ï¼‰Job&amp;CronJob</p>
<h3 id="ä¸€-ã€Deploymentæ§åˆ¶å™¨æ¦‚è¿°"><a href="#ä¸€-ã€Deploymentæ§åˆ¶å™¨æ¦‚è¿°" class="headerlink" title="ä¸€)ã€Deploymentæ§åˆ¶å™¨æ¦‚è¿°"></a>ä¸€)ã€Deploymentæ§åˆ¶å™¨æ¦‚è¿°</h3><ul>
<li>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¹¶ä¸ç›´æ¥åˆ›å»º Podï¼Œè€Œæ˜¯é€šè¿‡ Deployment æ¥åˆ›å»º Podï¼Œç”± Deployment æ¥è´Ÿè´£åˆ›å»ºã€æ›´æ–°ã€ç»´æŠ¤å…¶æ‰€ç®¡ç†çš„æ‰€æœ‰ Podsã€‚</li>
</ul>
<p>ReplicationSetï¼ˆRSï¼‰å’ŒReplicationControllerï¼ˆRCï¼‰åŒºåˆ«</p>
<ul>
<li><p>è¿™é‡Œå°±éœ€è¦è¯´ä¸€ä¸‹ReplicationSetï¼ˆRSï¼‰å’ŒReplicationControllerï¼ˆRCï¼‰ï¼ŒRSæ˜¯åœ¨RCåŸºç¡€ä¸Šå‘å±•æ¥çš„ï¼Œåœ¨æ–°ç‰ˆçš„Kubernetesä¸­ï¼Œå·²ç»å°†RCæ›¿æ¢ä¸ºRS äº†ï¼Œå®ƒä»¬ä¸¤è€…æ²¡æœ‰æœ¬è´¨çš„åŒºåˆ«ï¼Œéƒ½æ˜¯ç”¨äºPodå‰¯æœ¬æ•°é‡çš„ç»´æŠ¤ä¸æ›´æ–°çš„ï¼Œä½¿å¾—å‰¯æœ¬æ•°é‡å§‹ç»ˆç»´æŒåœ¨ç”¨æˆ·å®šä¹‰èŒƒå›´å†…ï¼Œå³å¦‚æœå­˜åœ¨å®¹å™¨å¼‚å¸¸é€€å‡ºï¼Œæ­¤æ—¶ä¼šè‡ªåŠ¨åˆ›å»ºæ–°çš„Podè¿›è¡Œæ›¿ä»£ï¼›è€Œä¸”å¼‚å¸¸å¤šå‡ºæ¥çš„å®¹å™¨ä¹Ÿä¼šè‡ªåŠ¨å›æ”¶ã€‚</p>
</li>
<li><p>æ€»ç»“ä¸åŒç‚¹åœ¨äºï¼šRSåœ¨RCçš„åŸºç¡€ä¸Šæ”¯æŒé›†åˆåŒ–çš„selector</p>
</li>
<li><p>ä¸€èˆ¬æƒ…å†µä¸‹RSä¹Ÿæ˜¯å¯ä»¥å•ç‹¬ä½¿ç”¨çš„ï¼Œä½†æ˜¯ä¸€èˆ¬æ¨èå’ŒDeploymentä¸€èµ·ä½¿ç”¨ï¼Œè¿™æ ·ä¼šä½¿å¾—çš„Deploymentæä¾›çš„ä¸€äº›å›æ»šæ›´æ–°æ“ä½œåŒæ ·ç”¨äºRSä¸Šï¼Œå› ä¸º<strong>RSä¸æ”¯æŒå›æ»šæ›´æ–°æ“ä½œï¼ŒDeploymentæ”¯æŒ</strong>ï¼›</p>
</li>
</ul>
<h3 id="äºŒ-ã€Deploymentå·¥ä½œåŸç†"><a href="#äºŒ-ã€Deploymentå·¥ä½œåŸç†" class="headerlink" title="äºŒ)ã€Deploymentå·¥ä½œåŸç†"></a>äºŒ)ã€Deploymentå·¥ä½œåŸç†</h3><p>å…ˆçœ‹ä¸€ä¸‹Deploymentã€RSã€Podå®ƒä»¬ä¸‰è€…ä¹‹é—´çš„å…³ç³»ï¼š</p>
<p><img src="https://img-blog.csdnimg.cn/956f98633a9044bbb95c6fab15ee34af.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5a-S5rGf5a2k5b2xMDA3,size_16,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>RSè´Ÿè´£æ§åˆ¶å‰¯æœ¬æ•°é‡ï¼Œç”±Deploymentæ¥åˆ›å»ºå…·ä½“çš„Podã€‚</p>
<p>Deploymentæ§åˆ¶å™¨æ”¯æŒä¸¤ç§æ›´æ–°ç­–ç•¥ï¼šæ»šåŠ¨æ›´æ–°ï¼ˆrolling updateï¼‰å’Œé‡æ–°åˆ›å»ºï¼ˆrecreateï¼‰ï¼Œé»˜è®¤ä¸ºæ»šåŠ¨æ›´æ–°ã€‚</p>
<h4 id="1ï¼‰æ»šåŠ¨å‡çº§"><a href="#1ï¼‰æ»šåŠ¨å‡çº§" class="headerlink" title="1ï¼‰æ»šåŠ¨å‡çº§"></a>1ï¼‰æ»šåŠ¨å‡çº§</h4><p>æ»šåŠ¨å‡çº§æ˜¯é»˜è®¤çš„æ›´æ–°ç­–ç•¥ï¼Œå®ƒåœ¨åˆ é™¤ä¸€éƒ¨åˆ†æ—§ç‰ˆæœ¬Podèµ„æºçš„åŒæ—¶ï¼Œè¡¥å……åˆ›å»ºä¸€éƒ¨åˆ†æ–°ç‰ˆæœ¬çš„Podå¯¹è±¡è¿›è¡Œåº”ç”¨å‡çº§ï¼Œå…¶ä¼˜åŠ¿æ˜¯å‡çº§æœŸé—´ï¼Œå®¹å™¨ä¸­åº”ç”¨æä¾›çš„æœåŠ¡ä¸ä¼šä¸­æ–­ï¼Œä½†è¦æ±‚åº”ç”¨ç¨‹åºèƒ½å¤Ÿåº”å¯¹æ–°æ—§ç‰ˆæœ¬åŒæ—¶å·¥ä½œçš„æƒ…å½¢ï¼Œä¾‹å¦‚æ–°æ—§ç‰ˆæœ¬å…¼å®¹åŒä¸€ä¸ªæ•°æ®åº“æ–¹æ¡ˆç­‰ã€‚ä¸è¿‡ï¼Œæ›´æ–°æ“ä½œæœŸé—´ï¼Œä¸åŒå®¢æˆ·ç«¯å¾—åˆ°çš„å“åº”å†…å®¹å¯èƒ½ä¼šæ¥è‡ªä¸åŒç‰ˆæœ¬çš„åº”ç”¨ã€‚</p>
<p>Deploymentæ§åˆ¶å™¨çš„æ»šåŠ¨æ›´æ–°æ“ä½œå¹¶éåœ¨åŒä¸€ä¸ªReplicaSetæ§åˆ¶å™¨å¯¹è±¡ä¸‹åˆ é™¤å¹¶åˆ›å»ºPodèµ„æºï¼Œè€Œæ˜¯å°†å®ƒä»¬åˆ†ç½®äºä¸¤ä¸ªä¸åŒçš„æ§åˆ¶å™¨ä¹‹ä¸‹ï¼šæ—§æ§åˆ¶å™¨çš„Podå¯¹è±¡æ•°é‡ä¸æ–­å‡å°‘çš„åŒæ—¶ï¼Œæ–°æ§åˆ¶å™¨çš„Podå¯¹è±¡æ•°é‡ä¸æ–­å¢åŠ ï¼Œç›´åˆ°æ—§æ§åˆ¶å™¨ä¸å†æ‹¥æœ‰Podå¯¹è±¡ï¼Œè€Œæ–°æ§åˆ¶å™¨çš„å‰¯æœ¬æ•°é‡å˜å¾—å®Œå…¨ç¬¦åˆæœŸæœ›å€¼ä¸ºæ­¢ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://img-blog.csdnimg.cn/ebbee4d0609c4e2490eeff19722f31ed.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5a-S5rGf5a2k5b2xMDA3,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>æ»šåŠ¨æ›´æ–°æ—¶ï¼Œåº”ç”¨å‡çº§æœŸé—´è¿˜è¦ç¡®ä¿å¯ç”¨çš„Podå¯¹è±¡æ•°é‡ä¸ä½äºæŸé˜ˆå€¼ä»¥ç¡®ä¿å¯ä»¥æŒç»­å¤„ç†å®¢æˆ·ç«¯çš„æœåŠ¡è¯·æ±‚ï¼Œå˜åŠ¨çš„æ–¹å¼å’ŒPodå¯¹è±¡çš„æ•°é‡èŒƒå›´å°†é€šè¿‡spec.strategy.rollingUpdate.maxSurgeå’Œspec.strategy.rollingUpdate.maxUnavailableä¸¤ä¸ªå±æ€§ååŒè¿›è¡Œå®šä¹‰ï¼Œå®ƒä»¬çš„åŠŸç”¨å¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://img-blog.csdnimg.cn/87f8d64c397a4f57988d904fc2670da4.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5a-S5rGf5a2k5b2xMDA3,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<ul>
<li>maxSurgeï¼šæŒ‡å®šå‡çº§æœŸé—´å­˜åœ¨çš„æ€»Podå¯¹è±¡æ•°é‡æœ€å¤šå¯è¶…å‡ºæœŸæœ›å€¼çš„ä¸ªæ•°ï¼Œå…¶å€¼å¯ä»¥æ˜¯0æˆ–æ­£æ•´æ•°ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªæœŸæœ›å€¼çš„ç™¾åˆ†æ¯”ï¼›ä¾‹å¦‚ï¼Œå¦‚æœæœŸæœ›å€¼ä¸º3ï¼Œå½“å‰çš„å±æ€§å€¼ä¸º1ï¼Œåˆ™è¡¨ç¤ºPodå¯¹è±¡çš„æ€»æ•°ä¸èƒ½è¶…è¿‡4ä¸ªã€‚</li>
<li>maxUnavailableï¼šå‡çº§æœŸé—´æ­£å¸¸å¯ç”¨çš„Podå‰¯æœ¬æ•°ï¼ˆåŒ…æ‹¬æ–°æ—§ç‰ˆæœ¬ï¼‰æœ€å¤šä¸èƒ½ä½äºæœŸæœ›æ•°å€¼çš„ä¸ªæ•°ï¼Œå…¶å€¼å¯ä»¥æ˜¯0æˆ–æ­£æ•´æ•°ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªæœŸæœ›å€¼çš„ç™¾åˆ†æ¯”ï¼›é»˜è®¤å€¼ä¸º1ï¼Œè¯¥å€¼æ„å‘³ç€å¦‚æœæœŸæœ›å€¼æ˜¯3ï¼Œåˆ™å‡çº§æœŸé—´è‡³å°‘è¦æœ‰ä¸¤ä¸ªPodå¯¹è±¡å¤„äºæ­£å¸¸æä¾›æœåŠ¡çš„çŠ¶æ€ã€‚</li>
<li>maxSurgeå’ŒmaxUnavailableå±æ€§çš„å€¼ä¸å¯åŒæ—¶ä¸º0ï¼Œå¦åˆ™Podå¯¹è±¡çš„å‰¯æœ¬æ•°é‡åœ¨ç¬¦åˆç”¨æˆ·æœŸæœ›çš„æ•°é‡åæ— æ³•åšå‡ºåˆç†å˜åŠ¨ä»¥è¿›è¡Œæ»šåŠ¨æ›´æ–°æ“ä½œã€‚</li>
</ul>
<ol>
<li>&#96;&#96;&#96;<ul>
<li>maxUnavailableï¼šå’ŒæœŸæœ›readyçš„å‰¯æœ¬æ•°æ¯”ï¼Œä¸å¯ç”¨å‰¯æœ¬æ•°æœ€å¤§æ¯”ä¾‹ï¼ˆæˆ–æœ€å¤§å€¼ï¼‰ï¼Œ<em><strong>*è¿™ä¸ªå€¼è¶Šå°ï¼Œè¶Šèƒ½ä¿è¯æœåŠ¡ç¨³å®šï¼Œæ›´æ–°è¶Šå¹³æ»‘ï¼›*</strong></em></li>
<li>maxSurgeï¼šå’ŒæœŸæœ›readyçš„å‰¯æœ¬æ•°æ¯”ï¼Œè¶…è¿‡æœŸæœ›å‰¯æœ¬æ•°æœ€å¤§æ¯”ä¾‹ï¼ˆæˆ–æœ€å¤§å€¼ï¼‰ï¼Œ<em><strong>*è¿™ä¸ªå€¼è°ƒçš„è¶Šå¤§ï¼Œå‰¯æœ¬æ›´æ–°é€Ÿåº¦è¶Šå¿«ã€‚*</strong></em><figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext"><br>   1.è“ç»¿å‘å¸ƒï¼šä¸¤å¥—ç¯å¢ƒäº¤æ›¿å‡çº§ï¼Œæ—§ç‰ˆæœ¬ä¿ç•™ä¸€å®šæ—¶é—´ä¾¿äºå›æ»šã€‚<br><br>   2.ç°åº¦å‘å¸ƒï¼šæ ¹æ®æ¯”ä¾‹å°†è€ç‰ˆæœ¬å‡çº§ï¼Œä¾‹å¦‚80%ç”¨æˆ·è®¿é—®æ˜¯è€ç‰ˆæœ¬ï¼Œ20%ç”¨æˆ·è®¿é—®æ˜¯æ–°ç‰ˆæœ¬ã€‚<br><br>   3.æ»šåŠ¨å‘å¸ƒï¼šæŒ‰æ‰¹æ¬¡åœæ­¢è€ç‰ˆæœ¬å®ä¾‹ï¼Œå¯åŠ¨æ–°ç‰ˆæœ¬å®ä¾‹ã€‚<br><br>#### 2ï¼‰ç‰ˆæœ¬å›æ»š<br><br>Deploymentæ§åˆ¶å™¨ä¹Ÿæ”¯æŒç”¨æˆ·ä¿ç•™å…¶æ»šåŠ¨æ›´æ–°å†å²ä¸­çš„æ—§ReplicaSetå¯¹è±¡ç‰ˆæœ¬,è¿™èµ‹äºˆäº†æ§åˆ¶å™¨è¿›è¡Œåº”ç”¨å›æ»šçš„èƒ½åŠ›ï¼šç”¨æˆ·å¯æŒ‰éœ€å›æ»šåˆ°æŒ‡å®šçš„å†å²ç‰ˆæœ¬ã€‚æ§åˆ¶å™¨å¯ä¿å­˜çš„å†å²ç‰ˆæœ¬æ•°é‡ç”±â€œspec.revisionHistoryLimitâ€å±æ€§è¿›è¡Œå®šä¹‰ã€‚å½“ç„¶ï¼Œä¹Ÿåªæœ‰ä¿å­˜äºrevisionå†å²ä¸­çš„ReplicaSetç‰ˆæœ¬å¯ç”¨äºå›æ»šï¼Œå› æ­¤ï¼Œç”¨æˆ·è¦ä¹ æƒ¯æ€§åœ°åœ¨æ›´æ–°æ“ä½œæ—¶æŒ‡å®šä¿ç•™æ—§ç‰ˆæœ¬ã€‚<br><br>![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/719d6c89978b476089e08d0cd1a7778d.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5a-S5rGf5a2k5b2xMDA3,size_20,color_FFFFFF,t_70,g_se,x_16)<br><br>### ä¸‰)ã€Deploymentçš„èµ„æºæ¸…å•æ–‡ä»¶è¯¦è§£<br><br>```yaml<br>apiVersion: apps/v1     # ç‰ˆæœ¬å·<br>kind: Deployment        # ç±»å‹<br>metadata:               # å…ƒæ•°æ®<br>  name:                 # rsåç§°<br>  namespace:            # æ‰€å±å‘½åç©ºé—´<br>  labels:               # æ ‡ç­¾<br>    controller: deploy<br>spec:                   # è¯¦æƒ…æè¿°<br>  replicas:             # å‰¯æœ¬æ•°é‡<br>  revisionHistoryLimit: # ä¿ç•™å†å²ç‰ˆæœ¬ï¼Œé»˜è®¤æ˜¯10<br>  paused:               # æš‚åœéƒ¨ç½²ï¼Œé»˜è®¤æ˜¯false<br>  progressDeadlineSeconds:      # éƒ¨ç½²è¶…æ—¶æ—¶é—´(s)ï¼Œé»˜è®¤æ˜¯600<br>  strategy:             # ç­–ç•¥<br>    type: RollingUpdates        # æ»šåŠ¨æ›´æ–°ç­–ç•¥<br>    rollingUpdate:      # æ»šåŠ¨æ›´æ–°<br>      maxSurge:         # æœ€å¤§é¢å¤–å¯ä»¥å­˜åœ¨çš„å‰¯æœ¬æ•°ï¼Œå¯ä»¥ä¸ºç™¾åˆ†æ¯”ï¼Œä¹Ÿå¯ä»¥ä¸ºæ•´æ•°<br>      maxUnavaliable:   # æœ€å¤§ä¸å¯ç”¨çŠ¶æ€çš„podçš„æœ€å¤§å€¼ï¼Œå¯ä»¥ä¸ºç™¾åˆ†æ¯”ï¼Œä¹Ÿå¯ä»¥ä¸ºæ•´æ•°<br>  selector:             # é€‰æ‹©å™¨ï¼Œé€šè¿‡å®ƒæŒ‡å®šè¯¥æ§åˆ¶å™¨ç®¡ç†å“ªäº›pod<br>    matchLabels:        # LabelsåŒ¹é…è§„åˆ™<br>       app: nginx-pod<br>    matchExpressions:   # ExpressionåŒ¹é…è§„åˆ™<br>      - &#123;key: app, operator: In, values: [nginx-pod]&#125;<br>  template:             # æ¨¡æ¿ï¼Œå½“å‰¯æœ¬æ•°é‡ä¸è¶³æ—¶ï¼Œä¼šæ ¹æ®ä¸‹é¢çš„æ¨¡æ¿åˆ›å»ºpodå‰¯æœ¬<br>    metadata:<br>        labels:<br>          app: nginx-pod<br>    spec:<br>      containers:<br>      - name: nginx<br>        image: nginx:1.17.1<br>        ports:<br>        - containerPort: 80<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
</ol>
<h3 id="å››ã€Deploymentå®æˆ˜"><a href="#å››ã€Deploymentå®æˆ˜" class="headerlink" title="å››ã€Deploymentå®æˆ˜"></a>å››ã€Deploymentå®æˆ˜</h3><h4 id="1ï¼‰ç¤ºä¾‹1"><a href="#1ï¼‰ç¤ºä¾‹1" class="headerlink" title="1ï¼‰ç¤ºä¾‹1"></a>1ï¼‰ç¤ºä¾‹1</h4><p>åˆ›å»ºpc-deployment.yamlï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">pc-deployment</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">dev</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">replicas:</span> <span class="hljs-number">3</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">matchLabels:</span><br>     <span class="hljs-attr">app:</span> <span class="hljs-string">nginx-pod</span><br>  <span class="hljs-attr">template:</span><br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">app:</span> <span class="hljs-string">nginx-pod</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">containers:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">nginx</span><br>        <span class="hljs-attr">image:</span> <span class="hljs-string">nginx:1.17.1</span><br><br></code></pre></td></tr></table></figure>

<p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">$ kubectl create namespace dev<br>$ kubectl create -f pc-deployment.yaml<br>$ kubectl get deploy -n dev -o wide<br></code></pre></td></tr></table></figure>

<p>æŸ¥çœ‹deploymentæ§åˆ¶çš„rså’Œpodï¼Œå‘ç°rsæ˜¯åœ¨deploymentä¹‹ååŠ äº†ä¸€æ®µå­—ç¬¦ä¸²ï¼Œè€Œpodæ˜¯åœ¨rsä¹‹ååŠ äº†ä¸€æ®µå­—ç¬¦ä¸²ã€‚</p>
<p><img src="https://img-blog.csdnimg.cn/f6609e6b7a2246d695a74144cf06ea48.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<h4 id="2ï¼‰æ‰©ç¼©å®¹"><a href="#2ï¼‰æ‰©ç¼©å®¹" class="headerlink" title="2ï¼‰æ‰©ç¼©å®¹"></a>2ï¼‰æ‰©ç¼©å®¹</h4><p>æ–¹å¼ä¸€ï¼šå‘½ä»¤è¡Œ</p>
<p>æ ¼å¼</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">kubectl scale deploy deployåç§° --replicas=podæ•°é‡ -n å‘½åç©ºé—´<br></code></pre></td></tr></table></figure>

<p>è¿‡å‘½ä»¤è¡Œå˜æ›´podæ•°é‡ä¸º5ä¸ª</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">$ kubectl scale deploy pc-deployment --replicas=5 -n dev<br>$ kubectl get pod -n dev<br></code></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/b1b839e963224f8ea7c6cc36566c3b94.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>æ–¹å¼äºŒï¼šç¼–è¾‘deployæ–‡ä»¶</p>
<p>æ ¼å¼</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">kubectl edit deploy deployåå­— -n å‘½åç©ºé—´<br></code></pre></td></tr></table></figure>

<p>é€šè¿‡ç¼–è¾‘deployæ–‡ä»¶ç¼–è¾‘podæ•°é‡ä¸º3ä¸ª</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">$ kubectl edit deploy pc-deployment -n dev<br></code></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/aa454c2205894a94a94f2ff97fa07d82.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5a-S5rGf5a2k5b2xMDA3,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">$ kubectl get pod -n dev<br></code></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/b933ac07537b444b93bc565c13e3c33e.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<h4 id="3ï¼‰é•œåƒæ›´æ–°"><a href="#3ï¼‰é•œåƒæ›´æ–°" class="headerlink" title="3ï¼‰é•œåƒæ›´æ–°"></a>3ï¼‰é•œåƒæ›´æ–°</h4><p>deploymentæ”¯æŒä¸¤ç§é•œåƒæ›´æ–°ç­–ç•¥ï¼šé‡å»ºæ›´æ–°å’Œæ»šåŠ¨æ›´æ–°ï¼ˆé»˜è®¤ï¼‰ï¼Œå¯ä»¥é€šè¿‡strategyé€‰é¡¹è¿›è¡Œé…ç½®</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">strategyï¼šæŒ‡å®šæ–°çš„podæ›¿æ¢æ—§çš„podçš„ç­–ç•¥ï¼Œæ”¯æŒä¸¤ä¸ªå±æ€§ï¼š</span><br>  <span class="hljs-string">typeï¼šæŒ‡å®šç­–ç•¥ç±»å‹ï¼Œæ”¯æŒä¸¤ç§ç­–ç•¥</span><br>    <span class="hljs-string">Recreateï¼šåœ¨åˆ›å»ºå‡ºæ–°çš„podä¹‹å‰ä¼šå…ˆæ€æ‰æ‰€æœ‰å·²å­˜åœ¨çš„pod</span><br>    <span class="hljs-string">RollingUpdateï¼šæ»šåŠ¨æ›´æ–°ï¼Œå°±æ˜¯æ€æ­»ä¸€éƒ¨åˆ†ï¼Œå°±å¯åŠ¨ä¸€éƒ¨åˆ†ï¼Œåœ¨æ›´æ–°è¿‡ç¨‹ä¸­ï¼Œå­˜åœ¨ä¸¤ä¸ªç‰ˆæœ¬pod</span><br>  <span class="hljs-string">rollingUpdateï¼šå½“typeä¸ºRollingUpdateæ—¶ç”Ÿæ•ˆï¼Œç”¨äºä¸ºRollingUpdateè®¾ç½®å‚æ•°ï¼Œæ”¯æŒä¸¤ä¸ªå±æ€§</span><br>    <span class="hljs-string">maxUnavailableï¼šç”¨æ¥æŒ‡å®šåœ¨å‡çº§è¿‡ç¨‹ä¸­ä¸å¯ç”¨podçš„æœ€å¤§æ•°é‡ï¼Œé»˜è®¤ä¸º25%</span><br>    <span class="hljs-string">maxSurgeï¼šç”¨æ¥æŒ‡å®šåœ¨å‡çº§è¿‡ç¨‹ä¸­å¯ä»¥è¶…è¿‡æœŸæœ›çš„podçš„æœ€å¤§æ•°é‡ï¼Œé»˜è®¤ä¸º25%</span><br></code></pre></td></tr></table></figure>

<p>1ã€é‡å»ºæ›´æ–°</p>
<p>ç¼–è¾‘pc-deployment.yamlï¼Œåœ¨specèŠ‚ç‚¹ä¸‹æ·»åŠ æ›´æ–°ç­–ç•¥</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">strategy:</span>  <span class="hljs-comment">#ç­–ç•¥</span><br>    <span class="hljs-attr">type:</span> <span class="hljs-string">Recreate</span>  <span class="hljs-comment">#é‡å»ºæ›´æ–°ç­–ç•¥</span><br></code></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/5941ab45c28f4aa5a7f83f1b76ef7ea2.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5a-S5rGf5a2k5b2xMDA3,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">$ kubectl apply -f pc-deployment.yaml <br>$ kubectl get pod -n dev<br></code></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/29ce0a0cd9e84a1bb7938693f9e64d1c.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>åˆ›å»ºdeployè¿›è¡ŒéªŒè¯</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#é¦–å…ˆè®°å½•åŸæœ¬çš„podå</span><br>$ kubectl get pod -n dev<br><span class="hljs-comment">#æ›´æ”¹podé•œåƒ</span><br>$ kubectl <span class="hljs-built_in">set</span> image deploy pc-deployment nginx=nginx:1.17.2 -n dev<br><span class="hljs-comment">#å†æ¬¡æŸ¥çœ‹é•œåƒ</span><br>$ kubectl get pod -n dev<br></code></pre></td></tr></table></figure>

<p>å‘ç°podé•œåƒå·²ç»æ”¹å˜äº†</p>
<p><img src="https://img-blog.csdnimg.cn/fb4d38594be84f1ebcb6c8de5006d93a.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5a-S5rGf5a2k5b2xMDA3,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>2ã€æ»šåŠ¨æ›´æ–°<br>ç¼–è¾‘pc-deployment.yamlï¼Œåœ¨specèŠ‚ç‚¹ä¸‹æ·»åŠ æ»šåŠ¨æ›´æ–°ç­–ç•¥ï¼ˆä¹Ÿå¯ä»¥æŠŠstrategyå»æ‰ï¼Œå› ä¸ºé»˜è®¤æ»šåŠ¨æ›´æ–°ç­–ç•¥ï¼‰</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">strategy:</span><br>  <span class="hljs-attr">type:</span> <span class="hljs-string">RollingUpdate</span> <span class="hljs-comment">#æ»šåŠ¨æ›´æ–°ç­–ç•¥</span><br>  <span class="hljs-attr">rollingUpdate:</span><br>    <span class="hljs-attr">maxUnavailable:</span> <span class="hljs-number">25</span><span class="hljs-string">%</span><br>    <span class="hljs-attr">maxSurge:</span> <span class="hljs-number">25</span><span class="hljs-string">%</span><br></code></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/e0ffd85c0fc54c57b59910d8d6d795bd.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5a-S5rGf5a2k5b2xMDA3,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>æ‰§è¡Œ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">$ kubectl apply -f pc-deployment.yaml <br></code></pre></td></tr></table></figure>


<p>åˆ›å»ºdeployè¿›è¡ŒéªŒè¯</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#è®°å½•ä»¥å‰çš„pod</span><br>$ kubectl get pod -n dev<br><span class="hljs-comment">#æ›´æ–°é•œåƒ</span><br>$ kubectl <span class="hljs-built_in">set</span> image deploy pc-deployment nginx=nginx:1.17.3 -n dev<br><span class="hljs-comment">#æŸ¥çœ‹podçŠ¶æ€</span><br>$ kubectl get pod -n dev<br>$ kubectl get pod -n dev<br></code></pre></td></tr></table></figure>

<p>å‘ç°podæ˜¯æ—§çš„ä¸€éåœæ­¢æ–°çš„ä¸€è¾¹åˆ›å»ºï¼Œæœ€åå…¨å˜æˆäº†æ–°çš„<br>æ»šåŠ¨æ›´æ–°çš„è¿‡ç¨‹</p>
<p>3ã€é•œåƒæ›´æ–°ä¸­rsçš„å˜åŒ–</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#é‡å»ºdeployment</span><br>$ kubectl delete -f pc-deployment.yaml <br><span class="hljs-comment">#æ·»åŠ recordå‚æ•°ï¼Œè¡¨æ˜åˆ›å»ºæ—¶è®°å½•</span><br>$ kubectl create -f pc-deployment.yaml --record<br>$ kubectl get deploy,rs,pod -n dev<br></code></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/edea98baa36a460d85aa38bcf741a0b3.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5a-S5rGf5a2k5b2xMDA3,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>å‘ç°podæ˜¯æ—§çš„ä¸€éåœæ­¢æ–°çš„ä¸€è¾¹åˆ›å»ºï¼Œæœ€åå…¨å˜æˆäº†æ–°çš„<br>æ»šåŠ¨æ›´æ–°çš„è¿‡ç¨‹</p>
<p><img src="https://img-blog.csdnimg.cn/02fa31f987f34fc68614edeefe664616.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5a-S5rGf5a2k5b2xMDA3,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p><strong>3ã€é•œåƒæ›´æ–°ä¸­rsçš„å˜åŒ–</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#é‡å»ºdeployment</span><br>$ kubectl delete -f pc-deployment.yaml <br><span class="hljs-comment">#æ·»åŠ recordå‚æ•°ï¼Œè¡¨æ˜åˆ›å»ºæ—¶è®°å½•</span><br>$ kubectl create -f pc-deployment.yaml --record<br>$ kubectl get deploy,rs,pod -n dev<br></code></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/08add79d638e4eb89cfc5f6649d37376.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5a-S5rGf5a2k5b2xMDA3,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>æ‰“å¼€ä¸¤ä¸ªçª—å£ï¼Œç”¨äºç›‘å¬rså’Œpod<br>åœ¨2çª—å£ä¸­ç›‘å¬rsï¼Œ3çª—å£ä¸­ç›‘å¬pod</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#åœ¨2çª—å£ä¸­è¾“å…¥</span><br>$ kubectl get rs -n dev -w<br><span class="hljs-comment">#åœ¨3çª—å£ä¸­è¾“å…¥</span><br>OBOBOB$ kubectl get pod -n dev -w<br><span class="hljs-comment">#åœ¨1çª—å£ä¸­æ”¹å˜podé•œåƒ</span><br>OBOBOB$ kubectl <span class="hljs-built_in">set</span> image deploy pc-deployment nginx=nginx:1.17.2 -n dev<br></code></pre></td></tr></table></figure>
<p>OBOBOB<br>OBOBOBæŸ¥çœ‹3çª—å£ä¸­podçš„å˜åŒ–ï¼Œå‘ç°åºå·5å¼€å¤´çš„podåœ¨é€æ¸æš‚åœï¼Œåºå·7å¼€å¤´çš„podåœ¨é€æ¸åˆ›å»º<br>OBOBOB<br><img src="https://img-blog.csdnimg.cn/2165ecaf02fc42d0816bf49427304ff1.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5a-S5rGf5a2k5b2xMDA3,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>OBOBOBæŸ¥çœ‹2çª—å£ä¸­rsçš„å˜åŒ–ï¼Œå¯ä»¥çœ‹è§åºå·5å¼€å¤´çš„rsçš„podæ•°åœ¨å‡å°‘ï¼Œåºå·7å¼€å¤´çš„rsçš„podæ•°åœ¨å¢åŠ </p>
<p><img src="https://img-blog.csdnimg.cn/8c4c0a9f20844e0b81f32e6981800c96.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5a-S5rGf5a2k5b2xMDA3,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>åœ¨1çª—å£ä¸­æŸ¥çœ‹æœ€ç»ˆrså˜åŒ–ï¼Œå‘ç°åŸæ¥çš„rsä¾æ—§å­˜åœ¨ï¼Œåªæ˜¯podæ•°é‡å˜ä¸ºäº†0ï¼Œè€Œååˆæ–°äº§ç”Ÿäº†ä¸€ä¸ªrsï¼Œpodæ•°é‡ä¸º3ï¼Œå…¶å®è¿™å°±æ˜¯deploymentèƒ½å¤Ÿè¿›è¡Œç‰ˆæœ¬å›é€€çš„å¥¥å¦™æ‰€åœ¨ï¼Œåé¢ä¼šè¯¦ç»†è§£é‡Š</p>
<p><img src="https://img-blog.csdnimg.cn/71cede9408ad4c9abc2e410de61faa33.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<h4 id="4ï¼‰ç‰ˆæœ¬å›é€€"><a href="#4ï¼‰ç‰ˆæœ¬å›é€€" class="headerlink" title="4ï¼‰ç‰ˆæœ¬å›é€€"></a>4ï¼‰ç‰ˆæœ¬å›é€€</h4><p>1ã€ç®€ä»‹</p>
<p>deploymentæ”¯æŒç‰ˆæœ¬å‡çº§è¿‡ç¨‹ä¸­çš„æš‚åœï¼Œç»§ç»­åŠŸèƒ½ä»¥åŠç‰ˆæœ¬å›é€€ç­‰è¯¸å¤šåŠŸèƒ½ï¼Œä¸‹é¢å…·ä½“æ¥çœ‹<br>kubectl rolloutï¼šç‰ˆæœ¬å‡çº§ç›¸å…³åŠŸèƒ½ï¼Œæ”¯æŒä¸‹é¢çš„é€‰é¡¹ï¼š</p>
<ul>
<li><p>statusï¼šæ˜¾ç¤ºå½“å‰å‡çº§çŠ¶æ€</p>
</li>
<li><p>historyï¼šæ˜¾ç¤ºå‡çº§å†å²è®°å½•</p>
</li>
<li><p>pauseï¼šæš‚åœç‰ˆæœ¬å‡çº§è¿‡ç¨‹<br>OBOBOB- resumeï¼šç»§ç»­å·²ç»æš‚åœçš„ç‰ˆæœ¬å‡çº§è¿‡ç¨‹</p>
</li>
<li><p>restartï¼šé‡å¯ç‰ˆæœ¬å‡çº§è¿‡ç¨‹<br>OBOBOB- undoï¼šå›æ»šåˆ°ä¸Šä¸€çº§ç‰ˆæœ¬ï¼ˆå¯ä»¥ä½¿ç”¨â€“to-revisionå›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬ï¼‰<br>OBOBOBOBOBOB</p>
</li>
</ul>
<p>#æŸ¥çœ‹å‡çº§çŠ¶æ€</p>
<p>OBOBOB&#96;&#96;&#96;bash<br>$ kubectl rollout status deploy pc-deployment -n dev</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext"><br>#æŸ¥çœ‹å‡çº§å†å²ï¼ˆæ³¨æ„ï¼šå¦‚æœåªæ˜¾ç¤ºç‰ˆæœ¬å·è¯´æ˜ä¸€å¼€å§‹ä½¿ç”¨yamlåˆ›å»ºæ–‡ä»¶çš„æ—¶å€™æ²¡æœ‰åŠ ä¸Šâ€“recordå‘½ä»¤ï¼‰<br><br>```bash<br>$ kubectl rollout history deploy pc-deployment -n dev<br></code></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/4b710b0ecc7e4ba7ac0a8e68f94bb84c.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>2ã€ç‰ˆæœ¬å›æ»šå®éªŒ</p>
<p>#è¿™é‡Œä½¿ç”¨â€“to-revision&#x3D;1å›æ»šåˆ°1ç‰ˆæœ¬ï¼Œå¦‚æœçœç•¥è¿™ä¸ªé€‰é¡¹ï¼Œåˆ™ä¼šå›é€€åˆ°ä¸Šä¸ªç‰ˆæœ¬</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">$ kubectl rollout undo deploy pc-deployment --to-revision=1 -n dev<br></code></pre></td></tr></table></figure>

<p>#æŸ¥çœ‹æ˜¯å¦å›æ»šæˆåŠŸï¼Œå‘ç°5åºå·å¼€å¤´çš„rsè¢«å¯åŠ¨äº†</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">$ kubectl get rs -n dev<br></code></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/2630941c37ba4951b1c1e73c2e94ff30.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>å¯ä»¥çœ‹åˆ°ç‰ˆæœ¬7å¼€å¤´çš„å·²ç»å›æ»šåˆ°5å¼€å¤´çš„ç‰ˆæœ¬äº†ï¼Œè¿™ä¹Ÿå°±æ˜¯rsä¾æ—§å­˜åœ¨çš„åŸå› ã€‚</p>
<h3 id="äº”ã€Deploymenté‡‘ä¸é›€å‘å¸ƒï¼ˆç°åº¦å‘å¸ƒï¼‰"><a href="#äº”ã€Deploymenté‡‘ä¸é›€å‘å¸ƒï¼ˆç°åº¦å‘å¸ƒï¼‰" class="headerlink" title="äº”ã€Deploymenté‡‘ä¸é›€å‘å¸ƒï¼ˆç°åº¦å‘å¸ƒï¼‰"></a>äº”ã€Deploymenté‡‘ä¸é›€å‘å¸ƒï¼ˆç°åº¦å‘å¸ƒï¼‰</h3><p>deploymentæ”¯æŒæ›´æ–°è¿‡ç¨‹ä¸­çš„æ§åˆ¶ï¼Œå¦‚â€æš‚åœï¼ˆpauseï¼‰â€æˆ–â€ç»§ç»­ï¼ˆresumeï¼‰â€æ›´æ–°æ“ä½œã€‚</p>
<p>æ¯”å¦‚æœ‰ä¸€æ‰¹æ–°çš„podèµ„æºåˆ›å»ºå®Œæˆåç«‹å³æš‚åœæ›´æ–°è¿‡ç¨‹ï¼Œæ­¤æ—¶ï¼Œä»…å­˜åœ¨ä¸€éƒ¨åˆ†æ–°ç‰ˆæœ¬çš„åº”ç”¨ï¼Œä¸»ä½“éƒ¨åˆ†è¿˜æ˜¯æ—§çš„ç‰ˆæœ¬ã€‚ç„¶åï¼Œå†ç­›é€‰ä¸€å°éƒ¨åˆ†çš„ç”¨æˆ·è¯·æ±‚è·¯ç”±åˆ°æ–°çš„podåº”ç”¨ï¼Œç»§ç»­è§‚å¯Ÿèƒ½å¦ç¨³å®šåœ°æŒ‰æœŸæœ›çš„æ–¹å¼è¿è¡Œã€‚ç¡®å®šæ²¡é—®é¢˜ä¹‹åå†ç»§ç»­å®Œæˆä½™ä¸‹çš„podèµ„æºæ»šåŠ¨æ›´æ–°ï¼Œå¦åˆ™ç«‹å³å›æ»šæ›´æ–°æ“ä½œã€‚è¿™å°±æ˜¯æ‰€è°“çš„é‡‘ä¸é›€å‘å¸ƒï¼Œå…¶å®ä¹Ÿå«åšç°åº¦å‘å¸ƒã€‚</p>
<p>#æ›´æ–°deploymentç‰ˆæœ¬ï¼Œå¹¶é…ç½®æš‚åœdeployment</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">$ kubectl <span class="hljs-built_in">set</span> image deploy pc-deployment nginx=nginx:1.17.2 -n dev &amp;&amp; kubectl rollout pause deploy pc-deployment -n dev<br></code></pre></td></tr></table></figure>

<p>#æŸ¥çœ‹rsï¼Œå‘ç°è€ç‰ˆæœ¬rsæ²¡æœ‰å‡å°‘ï¼Œæ–°ç‰ˆæœ¬rså¢åŠ ä¸€ä¸ª</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">$ kubectl get rs -n dev<br></code></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/a18ccd72fea64a4ca84f223c01b02706.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>#æŸ¥çœ‹æ›´æ–°è¿‡ç¨‹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">$ kubectl rollout status deploy pc-deployment -n dev<br>$ kubectl get rs -n dev<br></code></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/f59f5a14634f42cc817a224c01614b8d.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5a-S5rGf5a2k5b2xMDA3,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>å‘ç°è€ç‰ˆæœ¬å‡åœæ­¢ï¼Œæ–°ç‰ˆæœ¬å·²ç»åˆ›å»ºå¥½</p>
<h3 id="å…­ã€æœ‰çŠ¶æ€ã€æ— çŠ¶æ€æœåŠ¡åŒºåˆ«"><a href="#å…­ã€æœ‰çŠ¶æ€ã€æ— çŠ¶æ€æœåŠ¡åŒºåˆ«" class="headerlink" title="å…­ã€æœ‰çŠ¶æ€ã€æ— çŠ¶æ€æœåŠ¡åŒºåˆ«"></a>å…­ã€æœ‰çŠ¶æ€ã€æ— çŠ¶æ€æœåŠ¡åŒºåˆ«</h3><h4 id="1ï¼‰æ— çŠ¶æ€ï¼š"><a href="#1ï¼‰æ— çŠ¶æ€ï¼š" class="headerlink" title="1ï¼‰æ— çŠ¶æ€ï¼š"></a>1ï¼‰æ— çŠ¶æ€ï¼š</h4><ul>
<li>ä¸Šé¢æ‰€è¯´çš„deployment è®¤ä¸ºæ‰€æœ‰çš„podéƒ½æ˜¯ä¸€æ ·çš„</li>
<li>ä¸ç”¨è€ƒè™‘é¡ºåºçš„è¦æ±‚</li>
<li>ä¸ç”¨è€ƒè™‘åœ¨å“ªä¸ªnodeèŠ‚ç‚¹ä¸Šè¿è¡Œ</li>
<li>å¯ä»¥éšæ„æ‰©å®¹å’Œç¼©å®¹</li>
</ul>
<h4 id="2ï¼‰æœ‰çŠ¶æ€"><a href="#2ï¼‰æœ‰çŠ¶æ€" class="headerlink" title="2ï¼‰æœ‰çŠ¶æ€"></a>2ï¼‰æœ‰çŠ¶æ€</h4><ul>
<li>å®ä¾‹ä¹‹é—´æœ‰å·®åˆ«ï¼Œæ¯ä¸ªå®ä¾‹éƒ½æœ‰è‡ªå·±çš„ç‹¬ç‰¹æ€§ï¼Œå…ƒæ•°æ®ä¸åŒï¼Œä¾‹å¦‚etcdï¼Œzookeeper</li>
<li>å®ä¾‹ä¹‹é—´ä¸å¯¹ç­‰çš„å…³ç³»ï¼Œä»¥åŠä¾é å¤–éƒ¨å­˜å‚¨çš„åº”ç”¨</li>
</ul>
<h3 id="ä¸ƒã€PVã€PVCã€NFSã€SC"><a href="#ä¸ƒã€PVã€PVCã€NFSã€SC" class="headerlink" title="ä¸ƒã€PVã€PVCã€NFSã€SC"></a>ä¸ƒã€PVã€PVCã€NFSã€SC</h3><h4 id="1ï¼‰PVæ¦‚è¿°"><a href="#1ï¼‰PVæ¦‚è¿°" class="headerlink" title="1ï¼‰PVæ¦‚è¿°"></a>1ï¼‰PVæ¦‚è¿°</h4><ul>
<li><p>PersistentVolume (PVï¼šæŒä¹…åŒ–å­˜å‚¨å·)æ˜¯é›†ç¾¤ä¸­ç”±ç®¡ç†å‘˜æä¾›æˆ–ä½¿ç”¨å­˜å‚¨ç±»åŠ¨æ€æä¾›çš„ä¸€å—å­˜å‚¨ã€‚å®ƒæ˜¯é›†ç¾¤ä¸­çš„èµ„æºï¼Œå°±åƒèŠ‚ç‚¹æ˜¯é›†ç¾¤èµ„æºä¸€æ ·ã€‚</p>
</li>
<li><p>PVæ˜¯ä¸Volumesç±»ä¼¼çš„å·æ’ä»¶ï¼Œä½†å…¶ç”Ÿå‘½å‘¨æœŸä¸ä½¿ç”¨PVçš„ä»»ä½•å•ä¸ªPodæ— å…³ã€‚ç”±æ­¤APIå¯¹è±¡æ•è·å­˜å‚¨çš„å®ç°ç»†èŠ‚ï¼Œä¸ç®¡æ˜¯NFSã€iSCSIè¿˜æ˜¯ç‰¹å®šäºäº‘æä¾›å•†çš„å­˜å‚¨ç³»ç»Ÿã€‚</p>
</li>
</ul>
<h4 id="2ï¼‰PVCæ¦‚è¿°"><a href="#2ï¼‰PVCæ¦‚è¿°" class="headerlink" title="2ï¼‰PVCæ¦‚è¿°"></a>2ï¼‰PVCæ¦‚è¿°</h4><p>PersistentVolumeClaimï¼ˆPVCï¼šæŒä¹…åŒ–å­˜å‚¨å·å£°æ˜ï¼‰ï¼ŒPVC æ˜¯ç”¨æˆ·å­˜å‚¨çš„ä¸€ç§å£°æ˜ï¼ŒPVC å’Œ Pod æ¯”è¾ƒç±»ä¼¼ï¼ŒPod æ¶ˆè€—çš„æ˜¯èŠ‚ç‚¹ï¼ŒPVC æ¶ˆè€—çš„æ˜¯ PV èµ„æºï¼ŒPod å¯ä»¥è¯·æ±‚ CPU å’Œå†…å­˜ï¼Œè€Œ PVC å¯ä»¥è¯·æ±‚ç‰¹å®šçš„å­˜å‚¨ç©ºé—´å’Œè®¿é—®æ¨¡å¼ã€‚å¯¹äºçœŸæ­£ä½¿ç”¨å­˜å‚¨çš„ç”¨æˆ·ä¸éœ€è¦å…³å¿ƒåº•å±‚çš„å­˜å‚¨å®ç°ç»†èŠ‚ï¼Œåªéœ€è¦ç›´æ¥ä½¿ç”¨ PVC å³å¯ã€‚</p>
<h4 id="3ï¼‰é€šè¿‡NFSå®ç°æŒä¹…åŒ–å­˜å‚¨"><a href="#3ï¼‰é€šè¿‡NFSå®ç°æŒä¹…åŒ–å­˜å‚¨" class="headerlink" title="3ï¼‰é€šè¿‡NFSå®ç°æŒä¹…åŒ–å­˜å‚¨"></a>3ï¼‰é€šè¿‡NFSå®ç°æŒä¹…åŒ–å­˜å‚¨</h4><p>NFSå·¥ä½œåŸç†</p>
<ul>
<li><p>é¦–å…ˆæœåŠ¡å™¨ç«¯å¯åŠ¨RPCæœåŠ¡ï¼Œå¹¶å¼€å¯111ç«¯å£</p>
</li>
<li><p>æœåŠ¡å™¨ç«¯å¯åŠ¨NFSæœåŠ¡ï¼Œå¹¶å‘RPCæ³¨å†Œç«¯å£ä¿¡æ¯</p>
</li>
<li><p>å®¢æˆ·ç«¯å¯åŠ¨RPCï¼ˆrpcbindæœåŠ¡ï¼‰ï¼Œå‘æœåŠ¡ç«¯çš„RPC(rpcbind)æœåŠ¡è¯·æ±‚æœåŠ¡ç«¯çš„NFSç«¯å£</p>
</li>
<li><p>æœåŠ¡ç«¯çš„RPC(rpcbind)æœåŠ¡åé¦ˆNFSç«¯å£ä¿¡æ¯ç»™å®¢æˆ·ç«¯ã€‚</p>
</li>
<li><p>å®¢æˆ·ç«¯é€šè¿‡è·å–çš„NFSç«¯å£æ¥å»ºç«‹å’ŒæœåŠ¡ç«¯çš„NFSè¿æ¥å¹¶è¿›è¡Œæ•°æ®çš„ä¼ è¾“ã€‚</p>
</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/68c339a8b3e645f48de381c1faa4e422.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5a-S5rGf5a2k5b2xMDA3,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>å®‰è£…NFS</p>
<p>1ã€æ‰€æœ‰èŠ‚ç‚¹å®‰è£…nfs</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">$ yum -y install  nfs-utils rpcbind<br></code></pre></td></tr></table></figure>


<p>2ã€åœ¨masterèŠ‚ç‚¹åˆ›å»ºå…±äº«ç›®å½•å¹¶æˆæƒ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">mkdir</span> /opt/nfsdata<br><span class="hljs-comment"># æˆæƒå…±äº«ç›®å½•</span><br>$ <span class="hljs-built_in">chmod</span> 666 /opt/nfsdata<br></code></pre></td></tr></table></figure>

<p>3ã€ç¼–è¾‘exportsæ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">cat</span> /etc/exports<br>/opt/nfsdata *(rw,no_root_squash,no_all_squash,<span class="hljs-built_in">sync</span>)<br></code></pre></td></tr></table></figure>


<p>4ã€é…ç½®ç”Ÿæ•ˆ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">$ exportfs -r<br></code></pre></td></tr></table></figure>

<p>exportfså‘½ä»¤</p>
<blockquote>
<p>å¸¸ç”¨é€‰é¡¹<br>-a å…¨éƒ¨æŒ‚è½½æˆ–è€…å…¨éƒ¨å¸è½½<br>-r é‡æ–°æŒ‚è½½<br>-u å¸è½½æŸä¸€ä¸ªç›®å½•<br>-v æ˜¾ç¤ºå…±äº«ç›®å½• ä»¥ä¸‹æ“ä½œåœ¨æœåŠ¡ç«¯ä¸Š</p>
</blockquote>
<p>5ã€å¯åŠ¨rpcå’Œnfsï¼ˆå®¢æˆ·ç«¯åªéœ€è¦å¯åŠ¨rpcæœåŠ¡ï¼‰ï¼ˆæ³¨æ„é¡ºåºï¼‰</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">$ systemctl start rpcbind<br>$ systemctl start nfs-server<br>$ systemctl <span class="hljs-built_in">enable</span> rpcbind<br>$ systemctl <span class="hljs-built_in">enable</span> nfs-server<br></code></pre></td></tr></table></figure>


<p>6ã€æŸ¥çœ‹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">$ showmount -e<br>$ showmount -e 192.168.0.113<br></code></pre></td></tr></table></figure>

<ul>
<li>-e æ˜¾ç¤ºNFSæœåŠ¡å™¨çš„å…±äº«åˆ—è¡¨</li>
<li>-a æ˜¾ç¤ºæœ¬æœºæŒ‚è½½çš„æ–‡ä»¶èµ„æºçš„æƒ…å†µNFSèµ„æºçš„æƒ…å†µ</li>
<li>-v æ˜¾ç¤ºç‰ˆæœ¬å·</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/e2b8df67a1604b569669cd7402229515.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>7ã€å®¢æˆ·ç«¯</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å¯åŠ¨rpcæœåŠ¡</span><br>$ systemctl start rpcbind<br>$ systemctl <span class="hljs-built_in">enable</span> rpcbind<br><br><span class="hljs-comment"># åˆ›å»ºæŒ‚è½½ç›®å½•</span><br>$ <span class="hljs-built_in">mkdir</span> /mnt/nfsdata<br><br><span class="hljs-comment"># æŒ‚è½½</span><br>$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;192.168.0.113:/opt/nfsdata /mnt/nfsdata     nfs    defaults  0 1&quot;</span>&gt;&gt; /etc/fstab<br>$ mount -a<br></code></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/ab4b067ace56401fa448a282f3b85aeb.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5a-S5rGf5a2k5b2xMDA3,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>8ã€æµ‹è¯•</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å®¢æˆ·ç«¯æ‰§è¡Œ</span><br>$ <span class="hljs-built_in">touch</span> /mnt/nfsdata/test&#123;1..5&#125;<br>$ ll /mnt/nfsdata/<br><span class="hljs-comment"># æœåŠ¡ç«¯æ‰§è¡Œ</span><br>$ ll /opt/nfsdata/<br></code></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/06f26efc16b54a65aa5942649cc7a741.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<h4 id="4ï¼‰åŸºäºNFSå­˜å‚¨åˆ›å»ºPV"><a href="#4ï¼‰åŸºäºNFSå­˜å‚¨åˆ›å»ºPV" class="headerlink" title="4ï¼‰åŸºäºNFSå­˜å‚¨åˆ›å»ºPV"></a>4ï¼‰åŸºäºNFSå­˜å‚¨åˆ›å»ºPV</h4><p>æŸ¥çœ‹nfsç‰ˆæœ¬å·</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># nfsæœåŠ¡ç«¯ï¼Œåªèƒ½çœ‹åˆ°å¤§ç‰ˆæœ¬</span><br>$ nfsstat -s<br><span class="hljs-comment"># nfså®¢æˆ·ç«¯çœ‹</span><br>$ nfsstat -m<br></code></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/ba8d1ff77a2d43c7bf2123b86729743a.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5a-S5rGf5a2k5b2xMDA3,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># pv-nfs.yaml</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">PersistentVolume</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">bxy-pv</span><br>  <span class="hljs-attr">labels:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">bxy-pv-labels</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">capacity:</span><br>    <span class="hljs-attr">storage:</span> <span class="hljs-string">6Gi</span><br>  <span class="hljs-attr">volumeMode:</span> <span class="hljs-string">Filesystem</span><br>  <span class="hljs-attr">accessModes:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">ReadWriteMany</span><br>  <span class="hljs-attr">persistentVolumeReclaimPolicy:</span> <span class="hljs-string">Retain</span><br>  <span class="hljs-attr">storageClassName:</span> <span class="hljs-string">bxy-storageclass</span><br>  <span class="hljs-attr">mountOptions:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">hard</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">nfsvers=4.2</span><br>  <span class="hljs-attr">nfs:</span><br>    <span class="hljs-attr">path:</span> <span class="hljs-string">/opt/nfsdata</span><br>    <span class="hljs-attr">server:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.0</span><span class="hljs-number">.113</span><br><br></code></pre></td></tr></table></figure>

<p><strong>spec.storageClassName å­—æ®µå¯¹åº” StorageClass é…ç½®ä¸­çš„ metedata.name å­—æ®µ</strong></p>
<ul>
<li>capacity: #å®¹é‡</li>
<li>volumeMode: å­˜å‚¨å·æ¨¡å¼(é»˜è®¤å€¼ä¸ºfilesystem,é™¤äº†æ”¯æŒæ–‡ä»¶ç³»ç»Ÿå¤–ï¼ˆfile systemï¼‰ä¹Ÿæ”¯æŒå—è®¾å¤‡ï¼ˆraw block devicesï¼‰)</li>
<li>accessModes: è®¿é—®æ¨¡å¼</li>
<li>ReadWriteMany :ï¼ˆRWO&#x2F;è¯¥volumeåªèƒ½è¢«å•ä¸ªèŠ‚ç‚¹ä»¥è¯»å†™çš„æ–¹å¼æ˜ å°„ï¼‰,ReadOnlyMany (ROX&#x2F;è¯¥volumeå¯ä»¥è¢«å¤šä¸ªèŠ‚ç‚¹ä»¥åªè¯»æ–¹å¼æ˜ å°„), ReadWriteMany (RWX&#x2F;è¯¥volumeå¯ä»¥è¢«å¤šä¸ªèŠ‚ç‚¹ä»¥è¯»å†™çš„æ–¹å¼æ˜ å°„)</li>
<li>persistentVolumeReclaimPolicy: å›æ”¶ç­–ç•¥ ï¼ŒRetainï¼ˆä¿ç•™ï¼‰ã€ Recycleï¼ˆå›æ”¶ï¼‰æˆ–è€…Deleteï¼ˆåˆ é™¤ï¼‰</li>
<li>storageClassName: å­˜å‚¨ç±»(é€šè¿‡è®¾ç½®storageClassNameå­—æ®µè¿›è¡Œè®¾ç½®ã€‚å¦‚æœè®¾ç½®äº†å­˜å‚¨ç±»ï¼Œåˆ™æ­¤PVåªèƒ½è¢«ç»‘å®šåˆ°ä¹ŸæŒ‡å®šäº†æ­¤å­˜å‚¨ç±»çš„PVC)</li>
<li>mountOptions: æŒ‚æ¥é€‰é¡¹</li>
<li>path: æˆ‘çš„æœ¬åœ°æŒ‚è½½è·¯å¾„ä¸º</li>
<li>server: NFS æ–‡ä»¶ç³»ç»Ÿæ‰€åœ¨æœåŠ¡å™¨çš„çœŸå® IP</li>
</ul>
<p>æ‰§è¡Œ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">$ kubectl apply -f pv-nfs.yaml<br>$ kubectl get pv<br>$ kubectl describe pv bxy-pv<br></code></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/3e1e656cd1d94a108c832699b2c78744.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5a-S5rGf5a2k5b2xMDA3,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>æ³¨æ„åˆ›å»ºå®Œ PV åï¼Œä¼šçœ‹åˆ° Status ç±»å‹ä¸º Available ï¼Œè¿™æ˜¯å› ä¸º PV è¿˜æ²¡æœ‰å’Œ PVC ç»‘å®šï¼Œå½“ç»‘å®šæˆåŠŸåä¼šè‡ªåŠ¨æ”¹æˆ Boundã€‚</p>
<h4 id="5ï¼‰åŸºäºNFS-PVåˆ›å»ºPVC"><a href="#5ï¼‰åŸºäºNFS-PVåˆ›å»ºPVC" class="headerlink" title="5ï¼‰åŸºäºNFS-PVåˆ›å»ºPVC"></a>5ï¼‰åŸºäºNFS-PVåˆ›å»ºPVC</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext"># nfs-pv-pvc.yaml<br>apiVersion: v1<br>kind: PersistentVolumeClaim<br>metadata:<br>  name: bxy-pvc<br>spec:<br>  accessModes:<br>    - ReadWriteMany<br>  volumeMode: Filesystem<br>  resources:<br>    requests:<br>      storage: 5Gi<br>  storageClassName: bxy-storageclass<br>  selector:<br>    matchLabels:<br>      name: bxy-pv-labels<br></code></pre></td></tr></table></figure>

<ul>
<li><p>ã€æ³¨æ„ã€‘storage: 5Giï¼šæˆ‘å†™çš„æ˜¯ 5G ï¼Œä½†å®é™…ç»‘å®šæˆåŠŸåä¼šè‡ªåŠ¨æ”¹å˜ä¸º PV ä¸­è®¾ç½®çš„å®¹é‡å¤§å° 6Gã€‚</p>
</li>
<li><p>pvc é€šè¿‡ matchLabelså’Œpvä¸­çš„labelåŒ¹é…ï¼Œæ¥å…³è”è¦ä½¿ç”¨çš„å­˜å‚¨ç©ºé—´ã€‚è¡¨æ˜æ­¤PVCå¸Œæœ›ä½¿ç”¨Labelï¼šname: â€œbxy-pv-labelsâ€çš„PVã€‚</p>
</li>
</ul>
<p>æ‰§è¡Œ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">$ kubectl apply -f nfs-pv-pvc.yaml<br>$ kubectl get pvc<br><span class="hljs-comment"># å†æŸ¥çœ‹pvçŠ¶æ€</span><br>$ kubectl get pv<br></code></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/31a4471f776349498158a8ea9b776cec.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5a-S5rGf5a2k5b2xMDA3,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<h4 id="6ï¼‰SCï¼ˆStorageClassï¼šå­˜å‚¨ç±»ï¼‰"><a href="#6ï¼‰SCï¼ˆStorageClassï¼šå­˜å‚¨ç±»ï¼‰" class="headerlink" title="6ï¼‰SCï¼ˆStorageClassï¼šå­˜å‚¨ç±»ï¼‰"></a>6ï¼‰SCï¼ˆStorageClassï¼šå­˜å‚¨ç±»ï¼‰</h4><p>SCæ˜¯StorageClassçš„ç¼©å†™ï¼Œè¡¨ç¤ºå­˜å‚¨ç±»ï¼›è¿™ç§èµ„æºä¸»è¦ç”¨æ¥å¯¹pvèµ„æºçš„è‡ªåŠ¨ä¾›ç»™æä¾›æ¥å£ï¼›æ‰€è°“è‡ªåŠ¨ä¾›ç»™æ˜¯æŒ‡ç”¨æˆ·æ— éœ€æ‰‹åŠ¨åˆ›å»ºpvï¼Œè€Œæ˜¯åœ¨åˆ›å»ºpvcæ—¶å¯¹åº”pvä¼šç”±persistentVolume-controllerè‡ªåŠ¨åˆ›å»ºå¹¶å®Œæˆpvå’Œpvcçš„ç»‘å®šï¼›ä½¿ç”¨scèµ„æºçš„å‰ææ˜¯å¯¹åº”åç«¯å­˜å‚¨å¿…é¡»æ”¯æŒrestfullç±»å‹æ¥å£çš„ç®¡ç†æ¥å£ï¼Œå¹¶ä¸”pvcå¿…é¡»æŒ‡å®šå¯¹åº”å­˜å‚¨ç±»åç§°æ¥å¼•ç”¨SCï¼›ç®€å•è®²SCèµ„æºå°±æ˜¯ç”¨æ¥ä¸ºåç«¯å­˜å‚¨æä¾›è‡ªåŠ¨åˆ›å»ºpvå¹¶å…³è”å¯¹åº”pvcçš„æ¥å£ï¼›å¦‚ä¸‹å›¾ï¼š<br><img src="https://img-blog.csdnimg.cn/1e28a2d1bbac4eea94e0b1d498165921.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5a-S5rGf5a2k5b2xMDA3,size_19,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>ã€æç¤ºã€‘ä½¿ç”¨scåŠ¨æ€åˆ›å»ºpvï¼Œå¯¹åº”pvcå¿…é¡»ä¹Ÿæ˜¯å±äºå¯¹åº”çš„scï¼›ä¸Šå›¾ä¸»è¦æè¿°äº†ç”¨æˆ·åœ¨åˆ›å»ºpvcæ—¶ï¼Œå¼•ç”¨å¯¹åº”çš„scä»¥åï¼Œå¯¹åº”scä¼šè°ƒç”¨åº•å±‚å­˜å‚¨ç³»ç»Ÿçš„ç®¡ç†æ¥å£ï¼Œåˆ›å»ºå¯¹åº”çš„pvå¹¶å…³è”è‡³å¯¹åº”pvcã€‚</p>
<p>åˆ›å»ºscèµ„æº</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">storage.k8s.io/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">StorageClass</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">slow</span><br><span class="hljs-attr">provisioner:</span> <span class="hljs-string">kubernetes.io/glusterfs</span><br><span class="hljs-attr">parameters:</span><br>  <span class="hljs-attr">resturl:</span> <span class="hljs-string">&quot;http://127.0.0.1:8081&quot;</span><br>  <span class="hljs-attr">clusterid:</span> <span class="hljs-string">&quot;630372ccdc720a92c681fb928f27b53f&quot;</span><br>  <span class="hljs-attr">restauthenabled:</span> <span class="hljs-string">&quot;true&quot;</span><br>  <span class="hljs-attr">restuser:</span> <span class="hljs-string">&quot;admin&quot;</span><br>  <span class="hljs-attr">secretNamespace:</span> <span class="hljs-string">&quot;default&quot;</span><br>  <span class="hljs-attr">secretName:</span> <span class="hljs-string">&quot;heketi-secret&quot;</span><br>  <span class="hljs-attr">gidMin:</span> <span class="hljs-string">&quot;40000&quot;</span><br>  <span class="hljs-attr">gidMax:</span> <span class="hljs-string">&quot;50000&quot;</span><br>  <span class="hljs-attr">volumetype:</span> <span class="hljs-string">&quot;replicate:3&quot;</span><br></code></pre></td></tr></table></figure>

<p>ã€æç¤ºã€‘åœ¨åˆ›å»ºpvcæ—¶ç”¨storageClassNameå­—æ®µæ¥æŒ‡å®šå¯¹åº”çš„SCåç§°å³å¯ã€‚ä¸Šè¿°æ˜¯å®˜æ–¹æ–‡æ¡£ä¸­çš„ä¸€ä¸ªç¤ºä¾‹ï¼Œåœ¨åˆ›å»ºscèµ„æºæ—¶ï¼Œå¯¹åº”ç¾¤ç»„æ˜¯storage.k8s.io&#x2F;v1ï¼Œç±»å‹ä¸ºStorageClassï¼›provisionerå­—æ®µç”¨äºæè¿°å¯¹åº”ä¾›ç»™æ¥å£åç§°ï¼›parametersç”¨æ¥å®šä¹‰å‘å¯¹åº”å­˜å‚¨ç®¡ç†æ¥å£è¦ä¼ é€’çš„å‚æ•°ã€‚</p>
<h4 id="7ï¼‰åŸºäºåŠ¨æ€scï¼ˆStorageClassï¼šå­˜å‚¨ç±»ï¼‰"><a href="#7ï¼‰åŸºäºåŠ¨æ€scï¼ˆStorageClassï¼šå­˜å‚¨ç±»ï¼‰" class="headerlink" title="7ï¼‰åŸºäºåŠ¨æ€scï¼ˆStorageClassï¼šå­˜å‚¨ç±»ï¼‰"></a>7ï¼‰åŸºäºåŠ¨æ€scï¼ˆStorageClassï¼šå­˜å‚¨ç±»ï¼‰</h4><p>åˆ›å»ºä¸€ä¸ªpv</p>
<p>ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºstatefuesetçš„å‘½åç©ºé—´</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">$ cat &lt;&lt; EOF &gt; nginx-ns.yaml<br>apiVersion: v1<br>kind: Namespace<br>metadata:<br>  name: nginx-ss<br>EOF<br>$ kubectl apply -f nginx-ns.yaml<br></code></pre></td></tr></table></figure>

<p><strong>ç¬¬äºŒæ­¥ï¼šåˆ›å»ºServiceAccountï¼Œä¸ºnfs-client-provisioneræˆæƒ</strong><br>å¦‚æœé›†ç¾¤å¯ç”¨äº†RBACï¼Œåˆ™å¿…é¡»æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤æˆæƒprovisionerã€‚(k8s1.6+é»˜è®¤å¼€å¯)</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><code class="hljs YAML"><span class="hljs-string">$</span> <span class="hljs-string">cat</span> <span class="hljs-string">&lt;&lt;</span> <span class="hljs-string">EOF</span> <span class="hljs-string">&gt;</span> <span class="hljs-string">nfs-rbac.yaml</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ServiceAccount</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">nfs-client-provisioner</span><br>  <span class="hljs-comment"># replace with namespace where provisioner is deployed</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">nginx-ss</span>        <span class="hljs-comment">#æ ¹æ®å®é™…ç¯å¢ƒè®¾å®šnamespace,ä¸‹é¢ç±»åŒ</span><br><span class="hljs-meta">---</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ClusterRole</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">rbac.authorization.k8s.io/v1</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">nfs-client-provisioner-runner</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">nginx-ss</span><br><span class="hljs-attr">rules:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;&quot;</span>]<br>    <span class="hljs-attr">resources:</span> [<span class="hljs-string">&quot;persistentvolumes&quot;</span>]<br>    <span class="hljs-attr">verbs:</span> [<span class="hljs-string">&quot;get&quot;</span>, <span class="hljs-string">&quot;list&quot;</span>, <span class="hljs-string">&quot;watch&quot;</span>, <span class="hljs-string">&quot;create&quot;</span>, <span class="hljs-string">&quot;delete&quot;</span>]<br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;&quot;</span>]<br>    <span class="hljs-attr">resources:</span> [<span class="hljs-string">&quot;persistentvolumeclaims&quot;</span>]<br>    <span class="hljs-attr">verbs:</span> [<span class="hljs-string">&quot;get&quot;</span>, <span class="hljs-string">&quot;list&quot;</span>, <span class="hljs-string">&quot;watch&quot;</span>, <span class="hljs-string">&quot;update&quot;</span>]<br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;storage.k8s.io&quot;</span>]<br>    <span class="hljs-attr">resources:</span> [<span class="hljs-string">&quot;storageclasses&quot;</span>]<br>    <span class="hljs-attr">verbs:</span> [<span class="hljs-string">&quot;get&quot;</span>, <span class="hljs-string">&quot;list&quot;</span>, <span class="hljs-string">&quot;watch&quot;</span>]<br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;&quot;</span>]<br>    <span class="hljs-attr">resources:</span> [<span class="hljs-string">&quot;events&quot;</span>]<br>    <span class="hljs-attr">verbs:</span> [<span class="hljs-string">&quot;create&quot;</span>, <span class="hljs-string">&quot;update&quot;</span>, <span class="hljs-string">&quot;patch&quot;</span>]<br><span class="hljs-meta">---</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ClusterRoleBinding</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">rbac.authorization.k8s.io/v1</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">run-nfs-client-provisioner</span><br><span class="hljs-attr">subjects:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">kind:</span> <span class="hljs-string">ServiceAccount</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">nfs-client-provisioner</span><br>    <span class="hljs-attr">namespace:</span> <span class="hljs-string">nginx-ss</span><br>    <span class="hljs-comment"># replace with namespace where provisioner is deployed</span><br><span class="hljs-attr">roleRef:</span><br>  <span class="hljs-attr">kind:</span> <span class="hljs-string">ClusterRole</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">nfs-client-provisioner-runner</span><br>  <span class="hljs-attr">apiGroup:</span> <span class="hljs-string">rbac.authorization.k8s.io</span><br><span class="hljs-meta">---</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Role</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">rbac.authorization.k8s.io/v1</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">leader-locking-nfs-client-provisioner</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">nginx-ss</span><br>    <span class="hljs-comment"># replace with namespace where provisioner is deployed</span><br><span class="hljs-attr">rules:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;&quot;</span>]<br>    <span class="hljs-attr">resources:</span> [<span class="hljs-string">&quot;endpoints&quot;</span>]<br>    <span class="hljs-attr">verbs:</span> [<span class="hljs-string">&quot;get&quot;</span>, <span class="hljs-string">&quot;list&quot;</span>, <span class="hljs-string">&quot;watch&quot;</span>, <span class="hljs-string">&quot;create&quot;</span>, <span class="hljs-string">&quot;update&quot;</span>, <span class="hljs-string">&quot;patch&quot;</span>]<br><span class="hljs-meta">---</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">RoleBinding</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">rbac.authorization.k8s.io/v1</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">leader-locking-nfs-client-provisioner</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">nginx-ss</span><br><span class="hljs-attr">subjects:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">kind:</span> <span class="hljs-string">ServiceAccount</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">nfs-client-provisioner</span><br>    <span class="hljs-comment"># replace with namespace where provisioner is deployed</span><br>    <span class="hljs-attr">namespace:</span> <span class="hljs-string">nginx-ss</span><br><span class="hljs-attr">roleRef:</span><br>  <span class="hljs-attr">kind:</span> <span class="hljs-string">Role</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">leader-locking-nfs-client-provisioner</span><br>  <span class="hljs-attr">apiGroup:</span> <span class="hljs-string">rbac.authorization.k8s.io</span><br><span class="hljs-string">EOF</span><br><br></code></pre></td></tr></table></figure>

<p><strong>ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºnfsçš„nfs-client-provisioner</strong></p>
<p>nfs-client-provisioner æ˜¯k8sç®€æ˜“çš„NFSå¤–éƒ¨æä¾›è€…(provisioner)ï¼Œæœ¬èº«ä¸æä¾›NFSï¼Œåšä¸ºNFSçš„å®¢æˆ·ç«¯ä¸ºStorageClassæä¾›å­˜å‚¨ã€‚</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><code class="hljs YAML"><span class="hljs-string">$</span> <span class="hljs-string">cat</span> <span class="hljs-string">&lt;&lt;</span> <span class="hljs-string">EOF</span> <span class="hljs-string">&gt;</span> <span class="hljs-string">nfs-deployment-provisioner.yaml</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">nfs-client-provisioner</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">nginx-ss</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">replicas:</span> <span class="hljs-number">1</span><br>  <span class="hljs-attr">strategy:</span><br>    <span class="hljs-attr">type:</span> <span class="hljs-string">Recreate</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">matchLabels:</span><br>      <span class="hljs-attr">app:</span> <span class="hljs-string">nfs-client-provisioner</span><br>  <span class="hljs-attr">template:</span><br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">app:</span> <span class="hljs-string">nfs-client-provisioner</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">serviceAccountName:</span> <span class="hljs-string">nfs-client-provisioner</span><br>      <span class="hljs-attr">containers:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">nfs-client-provisioner</span><br>          <span class="hljs-attr">image:</span> <span class="hljs-string">quay.io/external_storage/nfs-client-provisioner:latest</span><br>          <span class="hljs-attr">volumeMounts:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">nfs-client-root</span><br>              <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/persistentvolumes</span> <span class="hljs-comment">#å®¹å™¨å†…æŒ‚è½½ç‚¹</span><br>          <span class="hljs-attr">env:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">PROVISIONER_NAME</span><br>              <span class="hljs-attr">value:</span> <span class="hljs-string">fuseim.pri/ifs</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">NFS_SERVER</span><br>              <span class="hljs-attr">value:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.0</span><span class="hljs-number">.113</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">NFS_PATH</span><br>              <span class="hljs-attr">value:</span> <span class="hljs-string">/opt/nfsdata</span><br>      <span class="hljs-attr">volumes:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">nfs-client-root</span> <span class="hljs-comment">#å®¿ä¸»æœºæŒ‚è½½ç‚¹</span><br>          <span class="hljs-attr">nfs:</span><br>            <span class="hljs-attr">server:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.0</span><span class="hljs-number">.113</span><br>            <span class="hljs-attr">path:</span> <span class="hljs-string">/opt/nfsdata</span><br><span class="hljs-string">EOF</span><br><span class="hljs-string">$</span> <span class="hljs-string">kubectl</span> <span class="hljs-string">apply</span> <span class="hljs-string">-f</span> <span class="hljs-string">nfs-deployment-provisioner.yaml</span><br><span class="hljs-string">$</span> <span class="hljs-string">kubectl</span> <span class="hljs-string">get</span> <span class="hljs-string">deploy</span> <span class="hljs-string">-n</span> <span class="hljs-string">nginx-ss</span><br></code></pre></td></tr></table></figure>

<p><strong>ç¬¬å››æ­¥ï¼šåŸºäºscåˆ›å»ºåŠ¨æ€å­˜å‚¨</strong></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><code class="hljs YAML"><span class="hljs-string">cat</span> <span class="hljs-string">&lt;&lt;</span> <span class="hljs-string">EOF</span> <span class="hljs-string">&gt;</span> <span class="hljs-string">nginx-sc.yaml</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">storage.k8s.io/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">StorageClass</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">nginx-nfs-storage</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">nginx-ss</span><br><span class="hljs-attr">provisioner:</span> <span class="hljs-string">fuseim.pri/ifs</span>  <span class="hljs-comment"># or choose another name, must match deployment&#x27;s env PROVISIONER_NAME&#x27;</span><br><span class="hljs-attr">reclaimPolicy:</span> <span class="hljs-string">Retain</span>        <span class="hljs-comment">#å›æ”¶ç­–ç•¥ï¼šRetainï¼ˆä¿ç•™ï¼‰ã€ Recycleï¼ˆå›æ”¶ï¼‰æˆ–è€…Deleteï¼ˆåˆ é™¤ï¼‰</span><br><span class="hljs-attr">volumeBindingMode:</span> <span class="hljs-string">Immediate</span>    <span class="hljs-comment">#volumeBindingModeå­˜å‚¨å·ç»‘å®šç­–ç•¥</span><br><span class="hljs-attr">allowVolumeExpansion:</span> <span class="hljs-literal">true</span>    <span class="hljs-comment">#pvcæ˜¯å¦å…è®¸æ‰©å®¹</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure>

<p>volumeBindingModeå­˜å‚¨å·ç»‘å®šç­–ç•¥</p>
<ul>
<li><p>Immediateï¼šåˆ›å»º PVC åç«‹å³åˆ›å»ºåç«¯å­˜å‚¨å·ï¼Œå¹¶ä¸”ç«‹å³ç»‘å®šæ–°åˆ›å»ºçš„ PV å’Œ PVCã€‚</p>
</li>
<li><p>WaitForFirstConsumerï¼šå½“ PVC è¢« Pod ä½¿ç”¨æ—¶ï¼Œæ‰è§¦å‘ PV å’Œåç«¯å­˜å‚¨çš„åˆ›å»ºï¼ŒåŒæ—¶å®ç° PVC&#x2F;PV çš„ç»‘å®šï¼Œå¯ç”¨è¯¥é…ç½®åï¼ŒStorage Class ä¸­çš„ Zone å’Œ Region å°†ä¸å†ç”Ÿæ•ˆï¼Œè€Œæ˜¯ä½¿ç”¨ Pod è°ƒåº¦æ‰€åœ¨èŠ‚ç‚¹çš„ zone å’Œ region åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿï¼Œä¿è¯æ–‡ä»¶ç³»ç»Ÿèƒ½è¢« Pod æŒ‚è½½ã€‚ï¼‰</p>
</li>
</ul>
<p>StorageClassçš„å®šä¹‰åŒ…å«å››ä¸ªéƒ¨åˆ†ï¼š</p>
<ul>
<li>provisionerï¼šè¯¥å­—æ®µæŒ‡å®šä½¿ç”¨å­˜å‚¨å·ç±»å‹ï¼Œä¸åŒçš„å­˜å‚¨å·æä¾›è€…ç±»å‹è¿™é‡Œè¦ä¿®æ”¹æˆå¯¹åº”çš„å€¼ã€‚ã€æ³¨æ„ã€‘provisionerå¿…é¡»å’Œä¸Šé¢å¾—Deploymentçš„YAMLæ–‡ä»¶ä¸­PROVISIONER_NAMEçš„å€¼ä¿æŒä¸€è‡´ã€‚</li>
<li>parametersï¼šæŒ‡å®š provisioner çš„é€‰é¡¹ï¼Œæ¯”å¦‚ glusterfs æ”¯æŒ resturlã€restuser ç­‰å‚æ•°ã€‚</li>
<li>mountOptionsï¼šæŒ‡å®šæŒ‚è½½é€‰é¡¹ï¼Œå½“ PV ä¸æ”¯æŒæŒ‡å®šçš„é€‰é¡¹æ—¶ä¼šç›´æ¥å¤±è´¥ã€‚æ¯”å¦‚ NFS æ”¯æŒ hard å’Œ nfsvers&#x3D;4.2 ç­‰é€‰é¡¹ã€‚</li>
<li>reclaimPolicyï¼šæŒ‡å®šå›æ”¶ç­–ç•¥ï¼ŒåŒ PV çš„å›æ”¶ç­–ç•¥ã€‚Retainï¼ˆä¿ç•™ï¼‰ã€ Recycleï¼ˆå›æ”¶ï¼‰æˆ–è€…Deleteï¼ˆåˆ é™¤ï¼‰</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs BASH">$ kubectl apply -f nginx-sc.yaml<br>$ kubectl get sc -n nginx-ss<br></code></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/047ab4ba7e374b0195c3763562034cc8.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<h3 id="å…«-ã€StatefulSetæ§åˆ¶å™¨"><a href="#å…«-ã€StatefulSetæ§åˆ¶å™¨" class="headerlink" title="å…«)ã€StatefulSetæ§åˆ¶å™¨"></a>å…«)ã€StatefulSetæ§åˆ¶å™¨</h3><h4 id="1ï¼‰ç®€ä»‹"><a href="#1ï¼‰ç®€ä»‹" class="headerlink" title="1ï¼‰ç®€ä»‹"></a><strong>1ï¼‰ç®€ä»‹</strong></h4><ul>
<li><p>StatefulSetæ˜¯ç”¨æ¥ç®¡ç†æœ‰çŠ¶æ€åº”ç”¨çš„å·¥ä½œè´Ÿè½½APIå¯¹è±¡ï¼Œå®ä¾‹ä¹‹é—´æœ‰ä¸å¯¹ç­‰å…³ç³»ï¼Œä»¥åŠå®ä¾‹å¯¹å¤–éƒ¨æ•°æ®æœ‰ä¾èµ–å…³ç³»çš„åº”ç”¨ï¼Œç§°ä¸ºâ€æœ‰çŠ¶æ€åº”ç”¨â€œã€‚</p>
</li>
<li><p>StatefulSetæœ¬è´¨ä¸Šæ˜¯Deploymentçš„ä¸€ç§å˜ä½“ï¼Œåœ¨v1.9ç‰ˆæœ¬ä¸­å·²æˆä¸ºGAç‰ˆæœ¬ï¼Œå®ƒä¸ºäº†è§£å†³æœ‰çŠ¶æ€æœåŠ¡çš„é—®é¢˜ï¼Œå®ƒæ‰€ç®¡ç†çš„Podæ‹¥æœ‰å›ºå®šçš„Podåç§°ï¼Œå¯åœé¡ºåºï¼Œåœ¨StatefulSetä¸­ï¼ŒPodåå­—ç§°ä¸ºç½‘ç»œæ ‡è¯†(hostname)ï¼Œè¿˜å¿…é¡»è¦ç”¨åˆ°å…±äº«å­˜å‚¨ã€‚</p>
</li>
<li><p>åœ¨Deploymentä¸­ï¼Œä¸ä¹‹å¯¹åº”çš„æœåŠ¡æ˜¯serviceï¼Œè€Œåœ¨StatefulSetä¸­ä¸ä¹‹å¯¹åº”çš„headless serviceï¼Œheadless serviceï¼Œå³æ— å¤´æœåŠ¡ï¼Œä¸serviceçš„åŒºåˆ«å°±æ˜¯å®ƒæ²¡æœ‰Cluster IPï¼Œè§£æå®ƒçš„åç§°æ—¶å°†è¿”å›è¯¥Headless Serviceå¯¹åº”çš„å…¨éƒ¨Podçš„Endpointåˆ—è¡¨ã€‚</p>
</li>
</ul>
<p>é™¤æ­¤ä¹‹å¤–ï¼ŒStatefulSetåœ¨Headless Serviceçš„åŸºç¡€ä¸Šåˆä¸ºStatefulSetæ§åˆ¶çš„æ¯ä¸ªPodå‰¯æœ¬åˆ›å»ºäº†ä¸€ä¸ªDNSåŸŸåï¼Œè¿™ä¸ªåŸŸåçš„æ ¼å¼ä¸ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">$(podname).(headless server name)<br>FQDNï¼š$(podname).(headless server name).namespace.svc.cluster.local<br></code></pre></td></tr></table></figure>

<h4 id="2ï¼‰å¸¸è§„serviceå’Œæ— å¤´æœåŠ¡åŒºåˆ«"><a href="#2ï¼‰å¸¸è§„serviceå’Œæ— å¤´æœåŠ¡åŒºåˆ«" class="headerlink" title="2ï¼‰å¸¸è§„serviceå’Œæ— å¤´æœåŠ¡åŒºåˆ«"></a>2ï¼‰å¸¸è§„serviceå’Œæ— å¤´æœåŠ¡åŒºåˆ«</h4><ul>
<li>serviceï¼šä¸€ç»„Podè®¿é—®ç­–ç•¥ï¼Œæä¾›cluster-IPç¾¤é›†ä¹‹é—´é€šè®¯ï¼Œè¿˜æä¾›è´Ÿè½½å‡è¡¡å’ŒæœåŠ¡å‘ç°ã€‚</li>
<li>Headless service æ— å¤´æœåŠ¡ï¼Œä¸éœ€è¦cluster-IPï¼Œç›´æ¥ç»‘å®šå…·ä½“çš„Podçš„IPã€‚</li>
</ul>
<h4 id="3ï¼‰ç‰¹ç‚¹"><a href="#3ï¼‰ç‰¹ç‚¹" class="headerlink" title="3ï¼‰ç‰¹ç‚¹"></a>3ï¼‰ç‰¹ç‚¹</h4><ul>
<li>Podä¸€è‡´æ€§ï¼šåŒ…å«æ¬¡åºï¼ˆå¯åŠ¨ã€åœæ­¢æ¬¡åºï¼‰ã€ç½‘ç»œä¸€è‡´æ€§ã€‚æ­¤ä¸€è‡´æ€§ä¸Podç›¸å…³ï¼Œä¸è¢«è°ƒåº¦åˆ°å“ªä¸ªnodeèŠ‚ç‚¹æ— å…³ï¼›</li>
<li>ç¨³å®šçš„æ¬¡åºï¼šå¯¹äºNä¸ªå‰¯æœ¬çš„StatefulSetï¼Œæ¯ä¸ªPodéƒ½åœ¨[0ï¼ŒN)çš„èŒƒå›´å†…åˆ†é…ä¸€ä¸ªæ•°å­—åºå·ï¼Œä¸”æ˜¯å”¯ä¸€çš„ï¼›</li>
<li>ç¨³å®šçš„ç½‘ç»œï¼šPodçš„hostnameæ¨¡å¼ä¸º( statefulset å ç§° ) âˆ’ (statefulsetåç§°)-(statefulsetåç§°)âˆ’(åºå·)ï¼›</li>
<li>ç¨³å®šçš„å­˜å‚¨ï¼šé€šè¿‡VolumeClaimTemplateä¸ºæ¯ä¸ªPodåˆ›å»ºä¸€ä¸ªPVã€‚åˆ é™¤ã€å‡å°‘å‰¯æœ¬ï¼Œä¸ä¼šåˆ é™¤ç›¸å…³çš„å·ã€‚</li>
</ul>
<h4 id="4ï¼‰ç»„æˆéƒ¨åˆ†"><a href="#4ï¼‰ç»„æˆéƒ¨åˆ†" class="headerlink" title="4ï¼‰ç»„æˆéƒ¨åˆ†"></a>4ï¼‰ç»„æˆéƒ¨åˆ†</h4><ul>
<li>Headless Serviceï¼šç”¨æ¥å®šä¹‰Podç½‘ç»œæ ‡è¯†( DNS domain)ï¼›</li>
<li>volumeClaimTemplates ï¼šå­˜å‚¨å·ç”³è¯·æ¨¡æ¿ï¼Œåˆ›å»ºPVCï¼ŒæŒ‡å®špvcåç§°å¤§å°ï¼Œå°†è‡ªåŠ¨åˆ›å»ºpvcï¼Œä¸”pvcå¿…é¡»ç”±å­˜å‚¨ç±»ä¾›åº”ï¼›</li>
</ul>
<p><strong>ä¸Šé¢ã€1-4ã€‘éƒ½å¾—æ‰§è¡Œï¼Œè¿™é‡Œæ˜¯ç¬¬äº”æ­¥ã€‚</strong><br>æ­¤å¤„æ˜¯åŸºäºSCï¼Œä¸Šé¢å·²ç»åˆ›å»ºè¿‡äº†SCï¼Œè¿™é‡Œå°±ç›´æ¥åˆ›å»ºStatefulSetäº†</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">cat</span> <span class="hljs-string">&lt;&lt;</span> <span class="hljs-string">EOF</span> <span class="hljs-string">&gt;</span> <span class="hljs-string">nginx-ss.yaml</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">StatefulSet</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">web</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">nginx-ss</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">matchLabels:</span><br>      <span class="hljs-attr">app:</span> <span class="hljs-string">nginx</span> <span class="hljs-comment">#å¿…é¡»åŒ¹é… .spec.template.metadata.labels</span><br>  <span class="hljs-attr">serviceName:</span> <span class="hljs-string">&quot;nginx&quot;</span>  <span class="hljs-comment">#å£°æ˜å®ƒå±äºå“ªä¸ªHeadless Service.</span><br>  <span class="hljs-attr">replicas:</span> <span class="hljs-number">3</span> <span class="hljs-comment">#å‰¯æœ¬æ•°</span><br>  <span class="hljs-attr">template:</span><br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">app:</span> <span class="hljs-string">nginx</span> <span class="hljs-comment"># å¿…é¡»é…ç½® .spec.selector.matchLabels</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">terminationGracePeriodSeconds:</span> <span class="hljs-number">10</span><br>      <span class="hljs-attr">containers:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">nginx</span><br>        <span class="hljs-attr">image:</span> <span class="hljs-string">nginx:1.17.1</span><br>        <span class="hljs-attr">ports:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">containerPort:</span> <span class="hljs-number">80</span><br>          <span class="hljs-attr">name:</span> <span class="hljs-string">web</span><br>        <span class="hljs-attr">volumeMounts:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">nginx-pvc</span><br>          <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/usr/share/nginx/html</span><br><br>  <span class="hljs-attr">volumeClaimTemplates:</span>   <span class="hljs-comment">#å¯çœ‹ä½œpvcçš„æ¨¡æ¿</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">name:</span> <span class="hljs-string">nginx-pvc</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">accessModes:</span> [ <span class="hljs-string">&quot;ReadWriteOnce&quot;</span> ]<br>      <span class="hljs-attr">storageClassName:</span> <span class="hljs-string">&quot;nginx-nfs-storage&quot;</span>  <span class="hljs-comment">#å­˜å‚¨ç±»åï¼Œå°±æ˜¯ä¸Šé¢nginx-sc.yaml metadata.name</span><br>      <span class="hljs-attr">resources:</span><br>        <span class="hljs-attr">requests:</span><br>          <span class="hljs-attr">storage:</span> <span class="hljs-string">1Gi</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„storageClassNameå¿…é¡»ä¸ä¸Šé¢SCé‡Œé¢çš„metadata.nameä¸€æ ·ã€‚<br>æ‰§è¡Œå‘½ä»¤</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">$ kubectl apply -f nginx-ss.yaml<br>$ kubectl get pods -n nginx-ss<br></code></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/aaac0aaf854d46659e499a6e887f7f17.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5a-S5rGf5a2k5b2xMDA3,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>ä¸Šè¿°ä¾‹å­ä¸­ï¼š</p>
<ul>
<li>åä¸º nginx çš„ Headless Service ç”¨æ¥æ§åˆ¶ç½‘ç»œåŸŸåã€‚</li>
<li>åä¸º web çš„ StatefulSet æœ‰ä¸€ä¸ª Specï¼Œå®ƒè¡¨æ˜å°†åœ¨ç‹¬ç«‹çš„ 3 ä¸ª Pod å‰¯æœ¬ä¸­å¯åŠ¨ nginx å®¹å™¨ã€‚</li>
<li>volumeClaimTemplates å°†é€šè¿‡ PersistentVolumes é©±åŠ¨æä¾›çš„ PersistentVolumes æ¥æä¾›ç¨³å®šçš„å­˜å‚¨ã€‚</li>
</ul>
<p>ã€é—®é¢˜ã€‘Kubernetes v1.20 (opens new window)å¼€å§‹ï¼Œé»˜è®¤åˆ é™¤äº† metadata.selfLink å­—æ®µï¼Œç„¶è€Œï¼Œéƒ¨åˆ†åº”ç”¨ä»ç„¶ä¾èµ–äºè¿™ä¸ªå­—æ®µï¼Œä¾‹å¦‚ä¸Šé¢çš„nfs-deployment-provisioner.yamlã€‚å…¶å®ä¸Šé¢åˆ›å»ºpodæ˜¯æ²¡æˆåŠŸçš„ã€‚æŠ¥é”™å¦‚ä¸‹ï¼š<br><img src="https://img-blog.csdnimg.cn/606e7793c2a64babb386bb77dc3ee55a.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5a-S5rGf5a2k5b2xMDA3,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>ã€è§£å†³ã€‘<br>é€šè¿‡é…ç½® apiserver å¯åŠ¨å‚æ•°ä¸­çš„ â€“feature-gates ä¸­çš„ RemoveSelfLink&#x3D;falseï¼Œå¯ä»¥é‡æ–°å¯ç”¨ metadata.selfLink å­—æ®µã€‚</p>
<p>ä¿®æ”¹ &#x2F;etc&#x2F;kubernetes&#x2F;manifests&#x2F;kube-apiserver.yaml æ–‡ä»¶ï¼Œå¹¶åœ¨å…¶å¯åŠ¨å‚æ•°ä¸­å¢åŠ ä¸€è¡Œ â€“ â€“feature-gates&#x3D;RemoveSelfLink&#x3D;falseï¼Œå¦‚ä¸‹ç¬¬ 43è¡Œæ‰€ç¤ºï¼š</p>
<p><img src="https://img-blog.csdnimg.cn/704fc256714246469fa6432f59d434ae.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>é‡æ–°åŠ è½½é…ç½®ï¼Œå¦‚æœä¸€æ¬¡æœªåŠ è½½æˆåŠŸï¼Œå¤šæ‰§è¡Œå‡ æ¬¡ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">$ kubectl apply -f /etc/kubernetes/manifests/kube-apiserver.yaml<br></code></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/1493b70a3e054e31acf4c04906a2deaf.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5a-S5rGf5a2k5b2xMDA3,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>åŠ è½½å®Œé…ç½®åï¼Œæˆ‘ä»¬å†çœ‹podåˆ›å»ºæƒ…å†µã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">$ kubectl get pvc -n nginx-ss<br>$ kubectl get pods -n nginx-ss<br></code></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/4823c1402fb0438bbd279ac492bf23de.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5a-S5rGf5a2k5b2xMDA3,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>æœ€åå‘½ä»¤æ€»ç»“ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æ¸…é™¤ï¼Œåªéœ€è¦åˆ é™¤å‘½åç©ºé—´å°±è¡Œ</span><br>$ kubectl delete -f nginx-ns.yaml<br><span class="hljs-comment"># é‡æ–°æ‰§è¡Œ</span><br>$ kubectl apply -f nginx-ns.yaml<br>$ kubectl apply -f nfs-rbac.yaml<br>$ kubectl apply -f nfs-deployment-provisioner.yaml<br>$ kubectl apply -f nginx-sc.yaml<br>$ kubectl apply -f nginx-ss.yaml<br><span class="hljs-comment"># æ£€æµ‹</span><br>$ kubectl get pvc -n nginx-ss<br>$ kubectl get pods -n nginx-ss<br></code></pre></td></tr></table></figure>

<h3 id="ä¹-ã€DaemonSetæ§åˆ¶å™¨"><a href="#ä¹-ã€DaemonSetæ§åˆ¶å™¨" class="headerlink" title="ä¹)ã€DaemonSetæ§åˆ¶å™¨"></a>ä¹)ã€DaemonSetæ§åˆ¶å™¨</h3><blockquote>
<p>DaemonSet ç¡®ä¿å…¨éƒ¨ï¼ˆæˆ–è€…ä¸€äº›ï¼‰Node ä¸Š<strong>è¿è¡Œä¸€ä¸ª Pod çš„å‰¯æœ¬</strong>ï¼Œé€šå¸¸ç”¨äºå®ç°ç³»ç»Ÿçº§åå°ä»»åŠ¡ã€‚æ¯”å¦‚ELKæœåŠ¡</p>
</blockquote>
<p>åˆ›å»ºDaemonSet</p>
<blockquote>
<p>DaemonSetçš„æè¿°æ–‡ä»¶å’ŒDeploymentéå¸¸ç›¸ä¼¼ï¼Œåªéœ€è¦ä¿®æ”¹Kindï¼Œå¹¶å»æ‰å‰¯æœ¬æ•°é‡çš„é…ç½®å³å¯ã€‚</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">cat</span> <span class="hljs-string">&lt;&lt;</span> <span class="hljs-string">EOF</span> <span class="hljs-string">&gt;</span> <span class="hljs-string">nginx-daemonset.yaml</span> <br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">DaemonSet</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">nginx-daemonset</span><br>  <span class="hljs-attr">labels:</span><br>    <span class="hljs-attr">app:</span> <span class="hljs-string">nginx</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">matchLabels:</span><br>      <span class="hljs-attr">app:</span> <span class="hljs-string">nginx</span><br>  <span class="hljs-attr">template:</span><br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">app:</span> <span class="hljs-string">nginx</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">containers:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">nginx</span><br>        <span class="hljs-attr">image:</span> <span class="hljs-string">nginx:1.13.12</span><br>        <span class="hljs-attr">ports:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">containerPort:</span> <span class="hljs-number">80</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">$ kubectl apply -f nginx-daemonset.yaml<br></code></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/796df00f34a740fc84a7259ae28cb211.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>åœ¨æ¯ä¸ªnodeèŠ‚ç‚¹ä¸Šéƒ½è¿è¡Œäº†ä¸€ä¸ªpodå‰¯æœ¬</p>
<h3 id="åï¼‰ã€Jobæ§åˆ¶å™¨"><a href="#åï¼‰ã€Jobæ§åˆ¶å™¨" class="headerlink" title="åï¼‰ã€Jobæ§åˆ¶å™¨"></a>åï¼‰ã€Jobæ§åˆ¶å™¨</h3><p>Jobæ§åˆ¶å™¨ç”¨äºè°ƒé…podå¯¹è±¡è¿è¡Œä¸€æ¬¡æ€§ä»»åŠ¡ï¼Œå®¹å™¨ä¸­çš„è¿›ç¨‹åœ¨æ­£å¸¸è¿è¡Œç»“æŸåä¸ä¼šå¯¹å…¶è¿›è¡Œé‡å¯ï¼Œè€Œæ˜¯å°†podå¯¹è±¡ç½®äºcompletedçŠ¶æ€ã€‚è‹¥å®¹å™¨ä¸­çš„è¿›ç¨‹å› é”™è¯¯è€Œç»ˆæ­¢ï¼Œåˆ™éœ€è¦ä¾æ®é…ç½®ç¡®å®šé‡å¯ä¸å¦ï¼Œæœªè¿è¡Œå®Œæˆçš„podå¯¹è±¡å› å…¶æ‰€åœ¨çš„èŠ‚ç‚¹æ•…éšœè€Œæ„å¤–ç»ˆæ­¢åä¼šè¢«é‡æ–°è°ƒåº¦ã€‚</p>
<p>ç®€å•ç¤ºä¾‹</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">cat</span> <span class="hljs-string">&lt;&lt;</span> <span class="hljs-string">EOF</span> <span class="hljs-string">&gt;</span> <span class="hljs-string">job-demo.yaml</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">batch/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Job</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">job-demo</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">template:</span><br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">name:</span> <span class="hljs-string">job-demo</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">restartPolicy:</span> <span class="hljs-string">Never</span><br>      <span class="hljs-attr">containers:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">counter</span><br>        <span class="hljs-attr">image:</span> <span class="hljs-string">busybox</span><br>        <span class="hljs-attr">command:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;bin/sh&quot;</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;-c&quot;</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;for i in 9 8 7 6 5 4 3 2 1; do echo $i; done&quot;</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure>

<p>Podæ¨¡æ¿ä¸­çš„spec.restartPolicyé»˜è®¤ä¸ºAlwaysï¼Œè¿™å¯¹jobæ§åˆ¶å™¨æ¥è¯´åªèƒ½è®¾å®šä¸ºNeveræˆ–OnFailureã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">$ kubectl apply -f job-test.yaml<br></code></pre></td></tr></table></figure>

<h3 id="åä¸€ï¼‰ã€CronJob-æ§åˆ¶å™¨"><a href="#åä¸€ï¼‰ã€CronJob-æ§åˆ¶å™¨" class="headerlink" title="åä¸€ï¼‰ã€CronJob æ§åˆ¶å™¨"></a>åä¸€ï¼‰ã€CronJob æ§åˆ¶å™¨</h3><ul>
<li><p>CronJobå…¶å®å°±æ˜¯åœ¨Jobçš„åŸºç¡€ä¸ŠåŠ ä¸Šäº†æ—¶é—´è°ƒåº¦ï¼Œæˆ‘ä»¬å¯ä»¥ï¼šåœ¨ç»™å®šçš„æ—¶é—´ç‚¹è¿è¡Œä¸€ä¸ªä»»åŠ¡ï¼Œä¹Ÿå¯ä»¥å‘¨æœŸæ€§åœ°åœ¨ç»™å®šæ—¶é—´ç‚¹è¿è¡Œã€‚è¿™ä¸ªå®é™…ä¸Šå’Œæˆ‘ä»¬Linuxä¸­çš„crontabå°±éå¸¸ç±»ä¼¼äº†ã€‚</p>
</li>
<li><p>ä¸€ä¸ªCronJobå¯¹è±¡å…¶å®å°±å¯¹åº”ä¸­crontabæ–‡ä»¶ä¸­çš„ä¸€è¡Œï¼Œå®ƒæ ¹æ®é…ç½®çš„æ—¶é—´æ ¼å¼å‘¨æœŸæ€§åœ°è¿è¡Œä¸€ä¸ªJobï¼Œæ ¼å¼å’Œcrontabä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚</p>
</li>
</ul>
<p>crontabçš„æ ¼å¼å¦‚ä¸‹ï¼š</p>
<ul>
<li>åˆ† æ—¶ æ—¥ æœˆ æ˜ŸæœŸ è¦è¿è¡Œçš„å‘½ä»¤ ç¬¬1åˆ—åˆ†é’Ÿ0ï½59 ç¬¬2åˆ—å°æ—¶0ï½23ï¼‰ ç¬¬3åˆ—æ—¥1ï½31 ç¬¬4åˆ—æœˆ1ï½12 ç¬¬5åˆ—æ˜ŸæœŸ0ï½7ï¼ˆ0å’Œ7è¡¨ç¤ºæ˜ŸæœŸå¤©ï¼‰ ç¬¬6åˆ—è¦è¿è¡Œçš„å‘½ä»¤</li>
</ul>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬ç”¨CronJobæ¥ç®¡ç†æˆ‘ä»¬ä¸Šé¢çš„Jobä»»åŠ¡</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">cat</span> <span class="hljs-string">&lt;&lt;</span> <span class="hljs-string">EOF</span> <span class="hljs-string">&gt;</span> <span class="hljs-string">cronjob-demo.yaml</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">batch/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">CronJob</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">cronjob-demo</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">schedule:</span> <span class="hljs-string">&quot;*/1 * * * *&quot;</span><br>  <span class="hljs-attr">jobTemplate:</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">template:</span><br>        <span class="hljs-attr">spec:</span><br>          <span class="hljs-attr">restartPolicy:</span> <span class="hljs-string">OnFailure</span><br>          <span class="hljs-attr">containers:</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">hello</span><br>            <span class="hljs-attr">image:</span> <span class="hljs-string">busybox</span><br>            <span class="hljs-attr">args:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;bin/sh&quot;</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;-c&quot;</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;for i in 9 8 7 6 5 4 3 2 1; do echo $i; done&quot;</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure>

<p>æ‰§è¡Œ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">$ kubectl get <span class="hljs-built_in">jobs</span><br>$ kubectl get cronjobs.batch<br></code></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/07a838dd44f745e8846987594553858a.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<h3 id="åäºŒï¼‰ã€æ€»ç»“"><a href="#åäºŒï¼‰ã€æ€»ç»“" class="headerlink" title="åäºŒï¼‰ã€æ€»ç»“"></a>åäºŒï¼‰ã€æ€»ç»“</h3><h4 id="1ï¼‰ReplicationControllerï¼ˆRCï¼‰ä¸»è¦åŠŸèƒ½"><a href="#1ï¼‰ReplicationControllerï¼ˆRCï¼‰ä¸»è¦åŠŸèƒ½" class="headerlink" title="1ï¼‰ReplicationControllerï¼ˆRCï¼‰ä¸»è¦åŠŸèƒ½"></a>1ï¼‰ReplicationControllerï¼ˆRCï¼‰ä¸»è¦åŠŸèƒ½</h4><ul>
<li>ReplicationControllerç”¨æ¥ç¡®ä¿å®¹å™¨åº”ç”¨çš„å‰¯æœ¬æ•°å§‹ç»ˆä¿æŒåœ¨ç”¨æˆ·å®šä¹‰çš„å‰¯æœ¬æ•°ï¼Œå³å¦‚æœæœ‰å®¹å™¨å¼‚å¸¸é€€å‡ºï¼Œä¼šè‡ªåŠ¨åˆ›å»ºæ–°çš„Podæ¥æ›¿ä»£ï¼›è€Œå¦‚æœå¼‚å¸¸å¤šå‡ºæ¥çš„å®¹å™¨ä¹Ÿä¼šè‡ªåŠ¨å›æ”¶ã€‚</li>
</ul>
<h4 id="2ï¼‰ReplicaSetä¸»è¦åŠŸèƒ½ï¼ˆRSï¼‰"><a href="#2ï¼‰ReplicaSetä¸»è¦åŠŸèƒ½ï¼ˆRSï¼‰" class="headerlink" title="2ï¼‰ReplicaSetä¸»è¦åŠŸèƒ½ï¼ˆRSï¼‰"></a>2ï¼‰ReplicaSetä¸»è¦åŠŸèƒ½ï¼ˆRSï¼‰</h4><ul>
<li><p>åœ¨æ–°ç‰ˆæœ¬çš„Kubernetesä¸­å»ºè®®ä½¿ç”¨ReplicaSetæ¥å–ReplicationControllerã€‚ReplicaSetè·ŸReplicationControlleræ²¡æœ‰æœ¬è´¨çš„ä¸åŒï¼Œåªæ˜¯åå­—ä¸ä¸€æ ·ï¼Œå¹¶ä¸”ReplicaSetæ”¯æŒé›†åˆå¼çš„selectorã€‚</p>
</li>
<li><p>è™½ç„¶ReplicaSetå¯ä»¥ç‹¬ç«‹ä½¿ç”¨ï¼Œä½†ä¸€èˆ¬è¿˜æ˜¯å»ºè®®ä½¿ç”¨ Deployment æ¥è‡ªåŠ¨ç®¡ç†ReplicaSetï¼Œè¿™æ ·å°±æ— éœ€æ‹…å¿ƒè·Ÿå…¶ä»–æœºåˆ¶çš„ä¸å…¼å®¹é—®é¢˜ï¼ˆæ¯”å¦‚ReplicaSetä¸æ”¯æŒrolling-updateä½†Deploymentæ”¯æŒï¼‰ã€‚</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">ç”¨æˆ·æœŸæœ›çš„podå‰¯æœ¬æ•°é‡<br>æ ‡ç­¾é€‰æ‹©å™¨ï¼Œåˆ¤æ–­å“ªä¸ªpodå½’è‡ªå·±ç®¡ç†<br>å½“ç°å­˜çš„podæ•°é‡ä¸è¶³ï¼Œä¼šæ ¹æ®podèµ„æºæ¨¡æ¿è¿›è¡Œæ–°å»º<br></code></pre></td></tr></table></figure>

<h4 id="3ï¼‰deploymentçš„ä¸»è¦åŠŸèƒ½"><a href="#3ï¼‰deploymentçš„ä¸»è¦åŠŸèƒ½" class="headerlink" title="3ï¼‰deploymentçš„ä¸»è¦åŠŸèƒ½"></a>3ï¼‰deploymentçš„ä¸»è¦åŠŸèƒ½</h4><ol>
<li>ç®¡ç†æ— çŠ¶æ€åº”ç”¨</li>
<li>ç®¡ç†Podå’ŒReplicaSet</li>
<li>å…·æœ‰ä¸Šçº¿éƒ¨ç½²ã€å‰¯æœ¬è®¾å®šã€æ»šåŠ¨å‡çº§ã€å›æ»šç­‰åŠŸèƒ½</li>
<li>æä¾›å£°æ˜å¼æ›´æ–°ï¼Œä¾‹å¦‚åªæ›´æ–°ä¸€ä¸ªæ–°çš„Image</li>
<li>åº”ç”¨åœºæ™¯ï¼šwebæœåŠ¡</li>
</ol>
<h4 id="4ï¼‰SatefulSetæ§åˆ¶å™¨"><a href="#4ï¼‰SatefulSetæ§åˆ¶å™¨" class="headerlink" title="4ï¼‰SatefulSetæ§åˆ¶å™¨"></a>4ï¼‰SatefulSetæ§åˆ¶å™¨</h4><ol>
<li>ç®¡ç†æœ‰çŠ¶æ€åº”ç”¨</li>
<li>kindï¼šservice</li>
<li>è§£å†³Podç‹¬ç«‹ç”Ÿå‘½å‘¨æœŸï¼Œä¿æŒPodå¯åŠ¨é¡ºåºå’Œå”¯ä¸€æ€§</li>
<li>ç¨³å®šï¼Œå”¯ä¸€çš„ç½‘ç»œæ ‡è¯†ç¬¦ï¼ŒæŒä¹…å­˜å‚¨ï¼ˆä¾‹å¦‚ï¼šetcdé…ç½®æ–‡ä»¶ï¼ŒèŠ‚ç‚¹åœ°å€å‘ç”Ÿå˜åŒ–ï¼Œå°†æ— æ³•ä½¿ç”¨ï¼‰</li>
<li>æœ‰åºï¼Œä¼˜é›…çš„éƒ¨ç½²å’Œæ‰©å±•ã€åˆ é™¤å’Œç»ˆæ­¢ï¼ˆä¾‹å¦‚ï¼šmysqlä¸»ä»å…³ç³»ï¼Œå…ˆå¯åŠ¨ä¸»ï¼Œå†å¯åŠ¨ä»ï¼‰ï¼Œæœ‰åºï¼Œæ»šåŠ¨æ›´æ–°</li>
<li>åº”ç”¨åœºæ™¯ï¼šæ•°æ®åº“</li>
</ol>
<h4 id="5ï¼‰DaemonSetæ§åˆ¶å™¨"><a href="#5ï¼‰DaemonSetæ§åˆ¶å™¨" class="headerlink" title="5ï¼‰DaemonSetæ§åˆ¶å™¨"></a>5ï¼‰DaemonSetæ§åˆ¶å™¨</h4><ol>
<li>å®ƒç”¨äºç¡®ä¿é›†ç¾¤ä¸­çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹åªè¿è¡Œç‰¹å®šçš„podå‰¯æœ¬ã€‚</li>
<li>6ï¼‰Job&amp;CronJob</li>
<li>Jobåªè¦å®Œæˆå°±ç«‹å³é€€å‡ºï¼Œä¸éœ€è¦é‡å¯æˆ–é‡å»ºã€‚</li>
<li>CronJobå…¶å®å°±æ˜¯åœ¨Jobçš„åŸºç¡€ä¸ŠåŠ ä¸Šäº†æ—¶é—´è°ƒåº¦ã€‚</li>
</ol>
<h4 id="æ–‡ç« ä½œè€…-å¯’æ±Ÿå­¤å½±007"><a href="#æ–‡ç« ä½œè€…-å¯’æ±Ÿå­¤å½±007" class="headerlink" title="æ–‡ç« ä½œè€…: @å¯’æ±Ÿå­¤å½±007"></a>æ–‡ç« ä½œè€…: @å¯’æ±Ÿå­¤å½±007</h4><h4 id="æ–‡ç« é“¾æ¥-https-blog-csdn-net-qq-35745940-article-details-120339730"><a href="#æ–‡ç« é“¾æ¥-https-blog-csdn-net-qq-35745940-article-details-120339730" class="headerlink" title="æ–‡ç« é“¾æ¥: https://blog.csdn.net/qq_35745940/article/details/120339730"></a>æ–‡ç« é“¾æ¥: <a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_35745940/article/details/120339730">https://blog.csdn.net/qq_35745940/article/details/120339730</a></h4></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="http://example.com">XiaoBei</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="http://example.com/2022/07/20/%E4%BA%94%E7%A7%8D%E6%8E%A7%E5%88%B6%E5%99%A8%E8%AF%A6%E8%A7%A3/">http://example.com/2022/07/20/%E4%BA%94%E7%A7%8D%E6%8E%A7%E5%88%B6%E5%99%A8%E8%AF%A6%E8%A7%A3/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="null" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="http://example.com" target="_blank">xiaobei</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/cloud/">cloud</a></div><div class="post_share"><div class="social-share" data-image="https://w.wallhaven.cc/full/kx/wallhaven-kxkdp7.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/07/21/Service%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="Serviceå­¦ä¹ ç¬”è®°"><img class="cover" src="https://w.wallhaven.cc/full/qz/wallhaven-qzge85.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">Serviceå­¦ä¹ ç¬”è®°</div></div></a></div><div class="next-post pull-right"><a href="/2022/07/20/%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB/" title="èµ„æºå¯¹è±¡å¯¹åº”å…³ç³»*-*"><img class="cover" src="https://th.wallhaven.cc/small/9m/9mjoy1.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">èµ„æºå¯¹è±¡å¯¹åº”å…³ç³»*-*</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><div><a href="/2022/08/01/Pod%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/" title="PodåŸºæœ¬æ¦‚å¿µ"><img class="cover" src="https://w.wallhaven.cc/full/l8/wallhaven-l8kwpr.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-08-01</div><div class="title">PodåŸºæœ¬æ¦‚å¿µ</div></div></a></div><div><a href="/2022/07/21/Service%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="Serviceå­¦ä¹ ç¬”è®°"><img class="cover" src="https://w.wallhaven.cc/full/qz/wallhaven-qzge85.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-07-21</div><div class="title">Serviceå­¦ä¹ ç¬”è®°</div></div></a></div><div><a href="/2022/07/20/%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB/" title="èµ„æºå¯¹è±¡å¯¹åº”å…³ç³»*-*"><img class="cover" src="https://th.wallhaven.cc/small/9m/9mjoy1.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-07-20</div><div class="title">èµ„æºå¯¹è±¡å¯¹åº”å…³ç³»*-*</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/wsnb.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">XiaoBei</div><div class="author-info__description">å½’é€”ä¹Ÿè¿˜å¯çˆ±</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">16</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">6</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">9</div></a></div><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/wsnbwz" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:wsnblove@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>å…¬å‘Š</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%94%E7%A7%8D%E6%8E%A7%E5%88%B6%E5%99%A8%E8%AF%A6%E8%A7%A3"><span class="toc-text">äº”ç§æ§åˆ¶å™¨è¯¦è§£</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80-%E3%80%81Deployment%E6%8E%A7%E5%88%B6%E5%99%A8%E6%A6%82%E8%BF%B0"><span class="toc-text">ä¸€)ã€Deploymentæ§åˆ¶å™¨æ¦‚è¿°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C-%E3%80%81Deployment%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-text">äºŒ)ã€Deploymentå·¥ä½œåŸç†</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%EF%BC%89%E6%BB%9A%E5%8A%A8%E5%8D%87%E7%BA%A7"><span class="toc-text">1ï¼‰æ»šåŠ¨å‡çº§</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E3%80%81Deployment%E5%AE%9E%E6%88%98"><span class="toc-text">å››ã€Deploymentå®æˆ˜</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%EF%BC%89%E7%A4%BA%E4%BE%8B1"><span class="toc-text">1ï¼‰ç¤ºä¾‹1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%EF%BC%89%E6%89%A9%E7%BC%A9%E5%AE%B9"><span class="toc-text">2ï¼‰æ‰©ç¼©å®¹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%EF%BC%89%E9%95%9C%E5%83%8F%E6%9B%B4%E6%96%B0"><span class="toc-text">3ï¼‰é•œåƒæ›´æ–°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%EF%BC%89%E7%89%88%E6%9C%AC%E5%9B%9E%E9%80%80"><span class="toc-text">4ï¼‰ç‰ˆæœ¬å›é€€</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%94%E3%80%81Deployment%E9%87%91%E4%B8%9D%E9%9B%80%E5%8F%91%E5%B8%83%EF%BC%88%E7%81%B0%E5%BA%A6%E5%8F%91%E5%B8%83%EF%BC%89"><span class="toc-text">äº”ã€Deploymenté‡‘ä¸é›€å‘å¸ƒï¼ˆç°åº¦å‘å¸ƒï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E6%9C%89%E7%8A%B6%E6%80%81%E3%80%81%E6%97%A0%E7%8A%B6%E6%80%81%E6%9C%8D%E5%8A%A1%E5%8C%BA%E5%88%AB"><span class="toc-text">å…­ã€æœ‰çŠ¶æ€ã€æ— çŠ¶æ€æœåŠ¡åŒºåˆ«</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%EF%BC%89%E6%97%A0%E7%8A%B6%E6%80%81%EF%BC%9A"><span class="toc-text">1ï¼‰æ— çŠ¶æ€ï¼š</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%EF%BC%89%E6%9C%89%E7%8A%B6%E6%80%81"><span class="toc-text">2ï¼‰æœ‰çŠ¶æ€</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%83%E3%80%81PV%E3%80%81PVC%E3%80%81NFS%E3%80%81SC"><span class="toc-text">ä¸ƒã€PVã€PVCã€NFSã€SC</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%EF%BC%89PV%E6%A6%82%E8%BF%B0"><span class="toc-text">1ï¼‰PVæ¦‚è¿°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%EF%BC%89PVC%E6%A6%82%E8%BF%B0"><span class="toc-text">2ï¼‰PVCæ¦‚è¿°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%EF%BC%89%E9%80%9A%E8%BF%87NFS%E5%AE%9E%E7%8E%B0%E6%8C%81%E4%B9%85%E5%8C%96%E5%AD%98%E5%82%A8"><span class="toc-text">3ï¼‰é€šè¿‡NFSå®ç°æŒä¹…åŒ–å­˜å‚¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%EF%BC%89%E5%9F%BA%E4%BA%8ENFS%E5%AD%98%E5%82%A8%E5%88%9B%E5%BB%BAPV"><span class="toc-text">4ï¼‰åŸºäºNFSå­˜å‚¨åˆ›å»ºPV</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5%EF%BC%89%E5%9F%BA%E4%BA%8ENFS-PV%E5%88%9B%E5%BB%BAPVC"><span class="toc-text">5ï¼‰åŸºäºNFS-PVåˆ›å»ºPVC</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6%EF%BC%89SC%EF%BC%88StorageClass%EF%BC%9A%E5%AD%98%E5%82%A8%E7%B1%BB%EF%BC%89"><span class="toc-text">6ï¼‰SCï¼ˆStorageClassï¼šå­˜å‚¨ç±»ï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7%EF%BC%89%E5%9F%BA%E4%BA%8E%E5%8A%A8%E6%80%81sc%EF%BC%88StorageClass%EF%BC%9A%E5%AD%98%E5%82%A8%E7%B1%BB%EF%BC%89"><span class="toc-text">7ï¼‰åŸºäºåŠ¨æ€scï¼ˆStorageClassï¼šå­˜å‚¨ç±»ï¼‰</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AB-%E3%80%81StatefulSet%E6%8E%A7%E5%88%B6%E5%99%A8"><span class="toc-text">å…«)ã€StatefulSetæ§åˆ¶å™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%EF%BC%89%E7%AE%80%E4%BB%8B"><span class="toc-text">1ï¼‰ç®€ä»‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%EF%BC%89%E5%B8%B8%E8%A7%84service%E5%92%8C%E6%97%A0%E5%A4%B4%E6%9C%8D%E5%8A%A1%E5%8C%BA%E5%88%AB"><span class="toc-text">2ï¼‰å¸¸è§„serviceå’Œæ— å¤´æœåŠ¡åŒºåˆ«</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%EF%BC%89%E7%89%B9%E7%82%B9"><span class="toc-text">3ï¼‰ç‰¹ç‚¹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%EF%BC%89%E7%BB%84%E6%88%90%E9%83%A8%E5%88%86"><span class="toc-text">4ï¼‰ç»„æˆéƒ¨åˆ†</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B9%9D-%E3%80%81DaemonSet%E6%8E%A7%E5%88%B6%E5%99%A8"><span class="toc-text">ä¹)ã€DaemonSetæ§åˆ¶å™¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%81%EF%BC%89%E3%80%81Job%E6%8E%A7%E5%88%B6%E5%99%A8"><span class="toc-text">åï¼‰ã€Jobæ§åˆ¶å™¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%81%E4%B8%80%EF%BC%89%E3%80%81CronJob-%E6%8E%A7%E5%88%B6%E5%99%A8"><span class="toc-text">åä¸€ï¼‰ã€CronJob æ§åˆ¶å™¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%81%E4%BA%8C%EF%BC%89%E3%80%81%E6%80%BB%E7%BB%93"><span class="toc-text">åäºŒï¼‰ã€æ€»ç»“</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%EF%BC%89ReplicationController%EF%BC%88RC%EF%BC%89%E4%B8%BB%E8%A6%81%E5%8A%9F%E8%83%BD"><span class="toc-text">1ï¼‰ReplicationControllerï¼ˆRCï¼‰ä¸»è¦åŠŸèƒ½</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%EF%BC%89ReplicaSet%E4%B8%BB%E8%A6%81%E5%8A%9F%E8%83%BD%EF%BC%88RS%EF%BC%89"><span class="toc-text">2ï¼‰ReplicaSetä¸»è¦åŠŸèƒ½ï¼ˆRSï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%EF%BC%89deployment%E7%9A%84%E4%B8%BB%E8%A6%81%E5%8A%9F%E8%83%BD"><span class="toc-text">3ï¼‰deploymentçš„ä¸»è¦åŠŸèƒ½</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%EF%BC%89SatefulSet%E6%8E%A7%E5%88%B6%E5%99%A8"><span class="toc-text">4ï¼‰SatefulSetæ§åˆ¶å™¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5%EF%BC%89DaemonSet%E6%8E%A7%E5%88%B6%E5%99%A8"><span class="toc-text">5ï¼‰DaemonSetæ§åˆ¶å™¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E7%AB%A0%E4%BD%9C%E8%80%85-%E5%AF%92%E6%B1%9F%E5%AD%A4%E5%BD%B1007"><span class="toc-text">æ–‡ç« ä½œè€…: @å¯’æ±Ÿå­¤å½±007</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E7%AB%A0%E9%93%BE%E6%8E%A5-https-blog-csdn-net-qq-35745940-article-details-120339730"><span class="toc-text">æ–‡ç« é“¾æ¥: https:&#x2F;&#x2F;blog.csdn.net&#x2F;qq_35745940&#x2F;article&#x2F;details&#x2F;120339730</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/06/06/Squid%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8-0/" title="Squidä»£ç†æœåŠ¡å™¨-2"><img src="https://th.wallhaven.cc/small/l3/l3xk6q.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Squidä»£ç†æœåŠ¡å™¨-2"/></a><div class="content"><a class="title" href="/2023/06/06/Squid%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8-0/" title="Squidä»£ç†æœåŠ¡å™¨-2">Squidä»£ç†æœåŠ¡å™¨-2</a><time datetime="2023-06-06T08:23:50.000Z" title="å‘è¡¨äº 2023-06-06 16:23:50">2023-06-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/06/06/%E6%96%87%E4%BB%B6%E5%85%B1%E4%BA%AB%E6%9C%8D%E5%8A%A1Samba/" title="æ–‡ä»¶å…±äº«æœåŠ¡Samba"><img src="https://w.wallhaven.cc/full/jx/wallhaven-jxkjj5.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="æ–‡ä»¶å…±äº«æœåŠ¡Samba"/></a><div class="content"><a class="title" href="/2023/06/06/%E6%96%87%E4%BB%B6%E5%85%B1%E4%BA%AB%E6%9C%8D%E5%8A%A1Samba/" title="æ–‡ä»¶å…±äº«æœåŠ¡Samba">æ–‡ä»¶å…±äº«æœåŠ¡Samba</a><time datetime="2023-06-06T08:23:26.000Z" title="å‘è¡¨äº 2023-06-06 16:23:26">2023-06-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/06/06/httpd%E5%9F%BA%E7%A1%80/" title="httpdåŸºç¡€"><img src="https://w.wallhaven.cc/full/rr/wallhaven-rryk81.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="httpdåŸºç¡€"/></a><div class="content"><a class="title" href="/2023/06/06/httpd%E5%9F%BA%E7%A1%80/" title="httpdåŸºç¡€">httpdåŸºç¡€</a><time datetime="2023-06-06T08:22:55.000Z" title="å‘è¡¨äº 2023-06-06 16:22:55">2023-06-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/06/06/Docker%E5%9F%BA%E7%A1%80/" title="DockeråŸºç¡€"><img src="https://w.wallhaven.cc/full/7p/wallhaven-7pw269.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="DockeråŸºç¡€"/></a><div class="content"><a class="title" href="/2023/06/06/Docker%E5%9F%BA%E7%A1%80/" title="DockeråŸºç¡€">DockeråŸºç¡€</a><time datetime="2023-06-06T08:22:42.000Z" title="å‘è¡¨äº 2023-06-06 16:22:42">2023-06-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/06/06/Chrony%E6%97%B6%E9%97%B4%E6%9C%8D%E5%8A%A1%E5%99%A8/" title="Chronyæ—¶é—´æœåŠ¡å™¨"><img src="https://w.wallhaven.cc/full/we/wallhaven-wel6or.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Chronyæ—¶é—´æœåŠ¡å™¨"/></a><div class="content"><a class="title" href="/2023/06/06/Chrony%E6%97%B6%E9%97%B4%E6%9C%8D%E5%8A%A1%E5%99%A8/" title="Chronyæ—¶é—´æœåŠ¡å™¨">Chronyæ—¶é—´æœåŠ¡å™¨</a><time datetime="2023-06-06T08:22:13.000Z" title="å‘è¡¨äº 2023-06-06 16:22:13">2023-06-06</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By XiaoBei</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"></div><canvas id="universe"></canvas><script defer src="/js/universe.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = true;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="true"></script><div class="fb-customerchat" id="fb-customer-chat" attribution="biz_inbox"></div><script>document.getElementById('fb-root') ? '' : document.body.insertAdjacentHTML('afterend', '<div id="fb-root"></div>')

window.fbAsyncInit = function() {
  FB.init({
    xfbml: true,
    version: 'v15.0'
  });
};

(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = 'https://connect.facebook.net/zh_CN/sdk/xfbml.customerchat.js';
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));

if (false) {
  var chatBtnFn = () => {
    var chatBtn = document.getElementById("chat_btn")
    chatBtn.addEventListener("click", function(){
      FB.CustomerChat.show();
    });
  }
  chatBtnFn()
} else {
  if (false) {
    function chatBtnHide () {
      FB.CustomerChat.hide()
    }
    function chatBtnShow () {
      FB.CustomerChat.show(false)
    }
  }
}</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">æœç´¢</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  æ•°æ®åº“åŠ è½½ä¸­</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="æœç´¢æ–‡ç« " type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></body></html>